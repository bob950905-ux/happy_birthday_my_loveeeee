<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 1 (Ultimate Stability Fix)</title>

<style>
/* í™”ë©´/ë¹„ë””ì˜¤ ê¸°ë³¸ */
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:#000;overflow:hidden;font-family:system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,'Noto Sans KR',sans-serif;}
video{width:100vw;height:100vh;object-fit:contain;background:#000}

/* ëŒ€í™”ì°½: ë°˜ë“œì‹œ í¬ì§€ì…˜ì„ ì¤˜ì„œ ë¹„ë””ì˜¤ ìœ„ì— ì˜¤ê²Œ */
.dialog{
  position:fixed;           /* â˜… í•µì‹¬: ë¹„ë””ì˜¤ ìœ„ë¡œ ë„ì›€ */
  left:50%;
  bottom:90px;              /* íƒ­ì¹© ìœ„ë¡œ ì ë‹¹íˆ */
  transform:translateX(-50%);
  width:min(92vw,680px);
  display:none;
  z-index:9999 !important;  /* ê°€ì¥ ìœ„ */
  pointer-events:none;      /* ë‚´ë¶€ ë²„íŠ¼ ì˜ì—­ë§Œ í´ë¦­ë˜ê²Œ */
}
.dialog.show{display:block!important}

/* ë§í’ì„  ë ˆì´ì•„ì›ƒ(ê°„ë‹¨ ë²„ì „) */
.row{display:flex;gap:12px;align-items:flex-end}
.avatar{width:56px;height:56px;border-radius:8px;object-fit:cover;filter:contrast(1.1)}
.bubble{
  flex:1;
  background:rgba(20,28,38,.92);
  color:#fff;
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px;
  padding:14px 16px;
  box-shadow:0 8px 24px rgba(0,0,0,.35);
}
.name{font-weight:800;opacity:.9;margin-bottom:6px}
.line{font-size:16px;line-height:1.5}
.center{display:flex;gap:10px;margin-top:12px;pointer-events:auto}
.btn{
  display:inline-flex;align-items:center;justify-content:center;
  padding:12px 16px;border-radius:12px;color:#fff;text-decoration:none;
  background:#2e5cff;border:1px solid rgba(255,255,255,.18);font-weight:700
}

/* íƒ­ì¹©: í•˜ë‹¨ ì¤‘ì•™ ê³ ì • */
.tapchip{
  position:fixed;left:50%;bottom:24px;transform:translateX(-50%);
  display:none;padding:14px 20px;border-radius:999px;font-weight:800;
  background:rgba(20,28,38,.9);color:#fff;border:1px solid rgba(255,255,255,.15);
  box-shadow:0 4px 18px rgba(0,0,0,.35);z-index:10001;font-size:15px
}
.tapchip:active{transform:translateX(-50%) scale(.97)}

/* START íŒíŠ¸ */
.hint{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  padding:10px 14px;border-radius:999px;background:rgba(20,28,38,.9);
  color:#fff;border:1px solid rgba(255,255,255,.15);z-index:10002;font-weight:800
}
</style>
</head>
<body>
<div class="stage">
  <video id="vid" src="./scene1_walk.mp4" preload="auto" playsinline webkit-playsinline muted></video>

  <div id="hint" class="hint">ğŸ¬ START!</div>
  <div id="tap"  class="tapchip">íƒ­!</div>

  <div id="dialog" class="dialog">
    <div class="row">
      <img id="avatar" class="avatar" src="./assets/avatar_seongwoo.png" alt="avatar">
      <div class="bubble">
        <div id="name" class="name">ì„±ìš°</div>
        <div id="line" class="line"></div>
        <div id="btns" class="center"></div>
      </div>
    </div>
  </div>
</div>

<script>
const vid    = document.getElementById('vid');
const hint   = document.getElementById('hint');
const tap    = document.getElementById('tap');
const dialog = document.getElementById('dialog');
const avatar = document.getElementById('avatar');
const nameEl = document.getElementById('name');
const line   = document.getElementById('line');
const btns   = document.getElementById('btns');

let tapAction=null, tapGuard=false;

/* íƒ­ì¹©: ëˆŒëŸ¬ì•¼ë§Œ ì§„í–‰ (ìš”ì²­ëŒ€ë¡œ) */
function setTap(next){ tapAction=next; tap.style.display='inline-flex'; }
function clearTap(){ tapAction=null; tap.style.display='none'; }
function triggerTap(){
  if(tapGuard) return;
  tapGuard=true; setTimeout(()=>tapGuard=false,160);
  const fn=tapAction; clearTap(); if(typeof fn==='function') fn();
}
tap.addEventListener('click', triggerTap, {passive:true});
tap.addEventListener('touchend', (e)=>{ e.preventDefault(); triggerTap(); }, {passive:false});

/* START: ëˆ„ë¥´ë©´ ë°”ë¡œ ì‚¬ë¼ì§€ê³  ì¬ìƒ ì‹œë„ */
function setupStart(){
  hint.style.display='block';
  const start=()=>{
    hint.style.display='none';
    vid.muted=true; vid.playsInline=true;
    vid.play().catch(()=>{ setTap(()=>vid.play()); });
    ['click','touchend','pointerdown'].forEach(ev=>document.removeEventListener(ev,start));
  };
  ['click','touchend','pointerdown'].forEach(ev=>document.addEventListener(ev,start,{once:true,passive:true}));
}

/* ëŒ€í™”ì°½ í‘œì‹œ */
function showDialog(text, who='ì„±ìš°', avatarSrc='./assets/avatar_seongwoo.png'){
  dialog.classList.add('show');       // â˜… ë¹„ë””ì˜¤ ìœ„ë¡œ ë³´ì´ê²Œ
  avatar.src = avatarSrc;
  nameEl.textContent = who;
  line.textContent   = text;
  btns.innerHTML     = '';
}

/* ì´ˆê¸° ì‹¤í–‰ */
setupStart();

/* ë¹„ë””ì˜¤ ë â†’ ëŒ€ì‚¬ ì§„í–‰ */
vid.addEventListener('ended', ()=>{
  showDialog('ì–´? ê½ƒì´ë„¤.');
  setTap(()=>{
    showDialog('ê²¨ìš¸ì— ë¬´ìŠ¨ ê½ƒì´ ë‹¤ í”¼ì—ˆëŒ€.');
    setTap(()=>{
      showDialog('ê·¸ë˜ë„... ì˜ˆì˜ë‹¤.');
      setTap(()=>{
        clearTap();
        const home = document.createElement('a');
        home.href = './index.html';
        home.className = 'btn';
        home.textContent = 'ë‹¤ìŒ ì„ ë¬¼ ê³ ë¥´ëŸ¬ ê°€ê¸° ğŸ';
        btns.appendChild(home);
      });
    });
  });
},{once:true});
</script>
</body>
</html>
