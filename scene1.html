<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 1 (Ultimate Stability Fix)</title>

<style>
/* ğŸš¨ íƒ­ì¹© CSS ë³µêµ¬ ë° ì•ˆì •í™” (ë¹„ì •ìƒì ìœ¼ë¡œ ê¸¸ì–´ì§€ëŠ” ë¬¸ì œ í•´ê²°) */
body {margin:0;background:#000;overflow:hidden;}
video {width:100vw;height:100vh;object-fit:contain;}
.dialog{display:none;}
.dialog.show{display:block!important;z-index:9999!important;}

.tapchip{
  position:fixed!important; /* ìœ„ì¹˜ ê³ ì • */
  left:50%;
  bottom:110px;
  transform:translateX(-50%);
  display:none;
  padding:15px 30px; /* í„°ì¹˜ ì˜ì—­ ì¶©ë¶„íˆ í™•ë³´ */
  border-radius:999px;
  background:rgba(20,28,38,.9);
  color:#fff;
  font-weight:700;
  font-size:1.2rem; /* í¬ê¸° í™•ëŒ€ */
  border:1px solid rgba(255,255,255,.15);
  box-shadow:0 4px 18px rgba(0,0,0,.35);
  z-index:10001; /* ëª¨ë“  ìš”ì†Œ ìœ„ì— ì˜¤ë„ë¡ z-index ê·¹ëŒ€í™” */
  width: auto !important; /* ë„ˆë¹„ê°€ ë¹„ì •ìƒì ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ëŠ” ê²ƒ ë°©ì§€ */
  height: auto !important; /* ë†’ì´ê°€ ë¹„ì •ìƒì ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ëŠ” ê²ƒ ë°©ì§€ */
}
.tapchip:active{transform:translateX(-50%) scale(.96);}

/* START íŒíŠ¸ë„ ëŒ€í™”ì°½ ìœ„ì— ì˜¤ë„ë¡ z-index ì„¤ì • */
.hint {
    position: fixed;
    z-index: 10002; 
    /* ... ui.cssì˜ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ì„ ë”°ë¥¸ë‹¤ê³  ê°€ì • ... */
}
</style>
</head>
<body>
<div class="stage">
  <video id="vid" src="./scene1_walk.mp4" preload="auto" playsinline webkit-playsinline muted></video>
  <div id="hint" class="hint">ğŸ¬ START!</div>
  <div id="tap" class="tapchip">íƒ­!</div>
  <div class="dialog" id="dialog">
    <div class="row">
      <img id="avatar" src="./assets/avatar_seongwoo.png" alt="avatar" style="width:60px;height:60px;border-radius:50%;"/>
      <div class="bubble">
        <div id="name">ì„±ìš°</div>
        <div id="line"></div>
        <div id="btns"></div>
      </div>
    </div>
  </div>
</div>

<script>
const vid=document.getElementById('vid');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');

let tapAction=null,tapGuard=false;

// --- ì›ë³¸ íƒ­ ë¡œì§ ìœ ì§€: íƒ­ì¹©ì„ ëˆŒë €ì„ ë•Œë§Œ ì‘ë™ ---
function setTap(next){tapAction=next;tap.style.display='inline-flex';}
function clearTap(){tapAction=null;tap.style.display='none';}
tap.addEventListener('click',e=>{
  if(tapGuard)return;
  tapGuard=true;setTimeout(()=>tapGuard=false,200);
  const fn=tapAction;clearTap();if(typeof fn==='function')fn();
});
tap.addEventListener('touchend',e=>{
  e.preventDefault();if(tapGuard)return;
  tapGuard=true;setTimeout(()=>tapGuard=false,200);
  const fn=tapAction;clearTap();if(typeof fn==='function')fn();
});

// --- ğŸš¨ setupStart ìˆ˜ì •: START ë²„íŠ¼ ì”ì¡´ ë¬¸ì œ í•´ê²° ---
function setupStart(){
  hint.style.display='block';
  
  const start=()=>{
    // ğŸš¨ START ë²„íŠ¼ì„ ì´ë²¤íŠ¸ ë°œìƒ ì¦‰ì‹œ ë¬´ì¡°ê±´ ìˆ¨ê¹€
    hint.style.display='none'; 
    vid.muted=true;vid.playsInline=true;
    
    vid.play().catch(()=>{
      // ìë™ ì¬ìƒ ì‹¤íŒ¨ ì‹œ, ë¹„ë””ì˜¤ ì¬ìƒì„ ìœ„í•œ íƒ­ì„ ì„¤ì •
      setTap(()=>vid.play());
    });
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
    ['click','touchend','pointerdown'].forEach(ev => document.removeEventListener(ev, start));
  };
  
  // ìµœì´ˆ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  ['click','touchend','pointerdown'].forEach(ev => document.addEventListener(ev, start, {once:true,passive:true}));
}

function showDialog(text,who='ì„±ìš°',avatarSrc='./assets/avatar_seongwoo.png'){
  dialog.classList.add('show');
  avatar.src=avatarSrc;
  nameEl.textContent=who;
  line.textContent=text;
  btns.innerHTML='';
}

// --- ì´ˆê¸° ì‹¤í–‰ ë° ëŒ€í™” ë¡œì§ ---
setupStart();
vid.addEventListener('ended',()=>{
  showDialog('ì–´? ê½ƒì´ë„¤.');
  setTap(()=>{
    showDialog('ê²¨ìš¸ì— ë¬´ìŠ¨ ê½ƒì´ ë‹¤ í”¼ì—ˆëŒ€.');
    setTap(()=>{
      showDialog('ê·¸ë˜ë„... ì˜ˆì˜ë‹¤.');
      setTap(()=>{
        clearTap();
        const home=document.createElement('a');
        home.href='./index.html';
        home.className='btn';
        home.textContent='ë‹¤ìŒ ì„ ë¬¼ ê³ ë¥´ëŸ¬ ê°€ê¸° ğŸ';
        btns.appendChild(home);
      });
    });
  });
},{once:true});
</script>
</body>
</html>
