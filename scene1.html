<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 1 (Stabilized)</title>
<link rel="stylesheet" href="./assets/ui.css"/>

<style>
/* ëŒ€í™”ì°½ì´ í™•ì‹¤íˆ ë³´ì´ë„ë¡ CSS í´ë˜ìŠ¤ ì •ì˜ */
.dialog { display: none; } /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
.dialog.show { 
    display: block !important; 
    /* ui.cssì— opacityë‚˜ z-index ì„¤ì •ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— !important ì¶”ê°€ ê°€ëŠ¥ */
    z-index: 9999;
}
</style>
</head>
<body>
<div class="stage">
  <video id="vid" src="./scene1_walk.mp4" preload="auto" playsinline webkit-playsinline muted></video>
  <div class="hint" id="hint">ğŸ¬ START!</div>
  <div class="tapchip" id="tap">íƒ­!</div>
  <div class="dialog" id="dialog">
    <div class="row" id="row">
      <img class="avatar" id="avatar" src="./assets/avatar_seongwoo.png" alt="avatar"/>
      <div class="bubble" id="bubble">
        <div class="name" id="name">ì„±ìš°</div>
        <div class="line" id="line"></div>
        <div class="center" id="btns"></div>
      </div>
    </div>
  </div>
  <div class="hearts" id="hearts"></div>
</div>
<script src="./assets/ui.js"></script>
<script>
const vid=document.getElementById('vid');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');

// setupStart í•¨ìˆ˜ëŠ” ui.jsì— ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
setupStart(vid, hint);

// ëŒ€í™”ì°½ì„ í‘œì‹œí•˜ê³  ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
function showDialog(text, avatarSrc='./assets/avatar_seongwoo.png', name='ì„±ìš°') {
    dialog.classList.add('show');
    avatar.src = avatarSrc;
    nameEl.textContent = name;
    line.textContent = text;
    btns.innerHTML = '';
    tap.style.display = 'block'; // íƒ­ì¹©ì„ í‘œì‹œí•˜ì—¬ íƒ­ì„ ìœ ë„í•©ë‹ˆë‹¤.
}

vid.addEventListener('ended', ()=>{
    // 1. ì˜ìƒ ì¢…ë£Œ í›„ íƒ­ì¹©ì„ ë„ì›Œ íƒ­ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
    tap.style.display = 'block'; 
    
    // 2. íƒ­ì¹©ì„ ëˆŒë €ì„ ë•Œë§Œ ë‹¤ìŒ ëŒ€ì‚¬ë¡œ ì§„í–‰ (ui.jsì˜ awaitTapOnce í•¨ìˆ˜ ì‚¬ìš©)
    awaitTapOnce(()=>{
        tap.style.display = 'none'; // ë‹¤ìŒ ëŒ€ì‚¬ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ íƒ­ì¹© ìˆ¨ê¹€
        
        // --- ëŒ€í™” ì‹œí€€ìŠ¤ ì‹œì‘ ---
        
        // 1ë²ˆì§¸ ëŒ€ì‚¬: ì–´? íƒœì´ì¸ê°€...?
        showDialog('ì–´? íƒœì´ì¸ê°€...?');
        
        // 2ë²ˆì§¸ íƒ­ ëŒ€ê¸°
        awaitTapOnce(()=>{
            // 2ë²ˆì§¸ ëŒ€ì‚¬: ê½ƒì´ì˜€ë„¤~~~ íƒœì´ì¸ì¤„ ì•Œì•˜ë„¤~
            showDialog('ê½ƒì´ì˜€ë„¤~~~ íƒœì´ì¸ì¤„ ì•Œì•˜ë„¤~');
            
            // ë²„íŠ¼ ìƒì„± ë° íƒ­ì¹© ìˆ¨ê¹€
            tap.style.display = 'none';
            const home=document.createElement('a');
            home.href='./index.html';
            home.className='btn';
            home.textContent='ë‹¤ìŒ ì„ ë¬¼ ê³ ë¥´ëŸ¬ ê°€ê¸° ğŸ';
            btns.appendChild(home);
        });
    });
}, {once:true});
</script>
</body>
</html>
