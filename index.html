<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ğŸ ë¦¬ë³¸ í’€ê¸°</title>
<style>
  :root { color-scheme: dark; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html,body { margin:0; background:#000; color:#fff; font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif; overflow:hidden; }
  .stage { position:fixed; inset:0; }

  /* ğŸ¥ ì˜ìƒì€ ê½‰ ì°¨ê²Œ, ë’¤ ë ˆì´ì–´ */
  video {
    position:absolute; inset:0; width:100vw; height:100vh;
    object-fit:contain; background:#000; z-index:0;
  }

  /* ğŸ€ ë¦¬ë³¸ í’€ê¸° (ì²˜ìŒ ì¤‘ì•™) */
  .start {
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
    padding:14px 22px; border-radius:999px; font-weight:900; letter-spacing:.3px;
    background:linear-gradient(45deg,#ffd6f0,#ff8ac6); color:#15192a;
    border:1px solid rgba(255,255,255,.18); box-shadow:0 10px 28px rgba(0,0,0,.45);
    z-index:10; user-select:none;
  }
  .start:active { transform:translate(-50%,-50%) scale(.98); }

  /* â¬‡ï¸ â€œíƒ­!â€ ìœ ë„ì¹© (ì˜¤í† í”Œë ˆì´ ì‹¤íŒ¨ ì‹œ) */
  .tapchip{
    position:fixed; left:50%;
    bottom:calc(env(safe-area-inset-bottom,0px) + 120px);
    transform:translateX(-50%);
    display:none; padding:12px 18px; border-radius:999px;
    background:rgba(20,28,38,.9); color:#fff; font-weight:800;
    border:1px solid rgba(255,255,255,.15); box-shadow:0 6px 22px rgba(0,0,0,.35);
    z-index:12;
  }
  .tapchip:active{ transform:translateX(-50%) scale(.98); }

  /* ğŸ’– í•˜íŠ¸ ë²„íŠ¼ ë°”: í•˜ë‹¨ë³´ë‹¤ ì‚´ì§ ìœ„ (ê°€ë ¤ì§€ì§€ ì•Šê²Œ) */
  .heart-bar{
    position:fixed; left:0; right:0;
    bottom:calc(env(safe-area-inset-bottom,0px) + 135px);
    display:flex; gap:14px; justify-content:center;
    padding:0 16px; z-index:11;
    pointer-events:none; /* ë²„íŠ¼ë§Œ í´ë¦­ë˜ë„ë¡ */
  }

  .heart{
    pointer-events:auto;
    position:relative;
    min-width:120px; padding:12px 16px;
    border-radius:999px; font-weight:900; letter-spacing:.3px;
    color:#0c1020; text-decoration:none;
    border:1px solid rgba(255,255,255,.14); box-shadow:0 10px 26px rgba(0,0,0,.42);
    opacity:0; transform:translateY(18px) scale(.96);
    transition:opacity .6s cubic-bezier(.16,.84,.44,1), transform .6s cubic-bezier(.16,.84,.44,1), filter .2s ease;
  }
  .heart.show { opacity:1; transform:translateY(0) scale(1); }
  .heart:active { transform:translateY(0) scale(.98); }

  /* ìƒ‰ìƒ: í•‘í¬ / ì˜¤ë Œì§€ / ë¸”ë£¨ */
  .pink   { background:linear-gradient(45deg,#ff90c2,#ff68b5); }
  .orange { background:linear-gradient(45deg,#ffc076,#ff8a33); }
  .blue   { background:linear-gradient(45deg,#7cc8ff,#3fa6ff); }

  /* ì ê¸ˆ ìƒíƒœ */
  .heart.locked { filter:grayscale(1); opacity:.55; pointer-events:none; }
  .locknote{
    position:absolute; left:50%; bottom:-26px; transform:translateX(-50%);
    font-size:.82rem; color:#bcc6d8; text-shadow:0 1px 3px #000;
    white-space:nowrap; user-select:none;
  }

  /* ë‘¥ì‹¤ë‘¥ì‹¤ ë¯¸ì„¸ ëª¨ì…˜(ì˜µì…˜) */
  .floaty{ animation:floaty 2.2s ease-in-out .2s infinite; }
  @keyframes floaty { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-3px)} }

  /* ì‘ì€ í™”ë©´ ë³´ì • */
  @media (max-height:740px){
    .heart-bar{ bottom:calc(env(safe-area-inset-bottom,0px) + 118px); gap:10px; }
    .heart{ min-width:110px; padding:10px 14px; }
  }
</style>
</head>
<body>
<div class="stage">
  <!-- ì„ ë¬¼ìƒì ì˜ìƒ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
  <video id="giftVideo" src="assets/gift_box.mp4" preload="auto" playsinline webkit-playsinline muted style="display:none;"></video>

  <!-- ì¤‘ì•™ ìŠ¤íƒ€íŠ¸ -->
  <button id="startBtn" class="start">ğŸ€ ë¦¬ë³¸ í’€ê¸°</button>
  <button id="tap" class="tapchip">íƒ­!</button>

  <!-- í•˜íŠ¸ ë²„íŠ¼ ë°” -->
  <nav class="heart-bar" id="heartBar" aria-label="ì„ ë¬¼ ì„ íƒ" style="display:none;">
    <a class="heart pink"   id="h1" href="./scene1.html"   aria-label="ì²« ë²ˆì§¸ ì„ ë¬¼">ğŸ’–</a>
    <a class="heart orange" id="h2" href="./scene2.html"   aria-label="ë‘ ë²ˆì§¸ ì„ ë¬¼">ğŸ§¡ğŸ§¡</a>
    <a class="heart blue"   id="h3" href="./scene3_4.html" aria-label="ì„¸ ë²ˆì§¸ ì„ ë¬¼">ğŸ’™ğŸ’™ğŸ’™</a>
  </nav>
</div>

<script>
/* ===== ì„¤ì •ê°’ ===== */
/* ì„ ë¬¼ìƒì ì˜ìƒ ê²½ë¡œ */
const VIDEO_SRC = 'assets/gift_box.mp4';

/* í•˜íŠ¸ ë“±ì¥ ê°„ê²©(ms): 0ì´ˆ / 5ì´ˆ / 10ì´ˆì— â€œíˆ­íˆ­íˆ­â€ */
const STAGGER_MS = 5000;

/* í•˜íŠ¸ ì ê¸ˆ í•´ì œ(ì´ˆ): ì¦‰ì‹œ / 1ì‹œê°„ / 2ì‹œê°„  (í…ŒìŠ¤íŠ¸ìš©: [0,10,20]) */
const UNLOCK_OFFSETS = [0, 60, 100];

/* ê¸°ì¤€ ì‹œê°„ í‚¤(localStorage) â€“ ìµœì´ˆ ë°©ë¬¸ ì‹œì  ê³ ì • */
const BASELINE_KEY = 'giftBaselineAt';

/* ===== ì—˜ë¦¬ë¨¼íŠ¸ ===== */
const startBtn = document.getElementById('startBtn');
const tapChip  = document.getElementById('tap');
const videoEl  = document.getElementById('giftVideo');
const heartBar = document.getElementById('heartBar');
const h1 = document.getElementById('h1');
const h2 = document.getElementById('h2');
const h3 = document.getElementById('h3');

/* ===== ìœ í‹¸: ë‚¨ì€ì‹œê°„ í¬ë§· ===== */
function fmtRemain(ms){
  if (ms <= 0) return 'ì—´ ìˆ˜ ìˆì–´ìš”!';
  const sec = Math.ceil(ms/1000);
  const hr  = Math.floor(sec/3600);
  const min = Math.floor((sec%3600)/60);
  if (hr > 0 && min > 0) return `â° ${hr}ì‹œê°„ ${min}ë¶„ ë’¤ì— ì—´ë ¤ìš”`;
  if (hr > 0) return `â° ${hr}ì‹œê°„ ë’¤ì— ì—´ë ¤ìš”`;
  return `â° ${min}ë¶„ ë’¤ì— ì—´ë ¤ìš”`;
}

/* ===== ê¸°ì¤€ ì‹œê°„(ìµœì´ˆ ë°©ë¬¸ ì‹œê°) í™•ë³´ ===== */
function getBaseline(){
  let t = localStorage.getItem(BASELINE_KEY);
  if (!t){
    t = Date.now().toString();
    localStorage.setItem(BASELINE_KEY, t);
  }
  return parseInt(t,10);
}

/* ===== í•˜íŠ¸ ì ê¸ˆ/íƒ€ì´ë¨¸ UI ì ìš© ===== */
function applyLocks(anchors){
  const baseline = getBaseline(); // ms
  anchors.forEach((a, idx)=>{
    const unlockAt = baseline + UNLOCK_OFFSETS[idx]*1000;
    const note = document.createElement('div');
    note.className = 'locknote';
    a.appendChild(note);

    function update(){
      const remain = unlockAt - Date.now();
      if (remain <= 0){
        a.classList.remove('locked');
        note.textContent = 'ì—´ ìˆ˜ ìˆì–´ìš”!';
      }else{
        a.classList.add('locked');
        note.textContent = fmtRemain(remain);
      }
    }
    update();
    setInterval(update, 10000); // 10ì´ˆë§ˆë‹¤ ê°±ì‹ 
  });
}

/* ===== í•˜íŠ¸ ë°” í‘œì‹œ(ì˜ìƒ ëë‚œ ë’¤) ===== */
function revealHearts(){
  heartBar.style.display = 'flex';

  // ì ê¸ˆ ë¡œì§ ì„¸íŒ…
  applyLocks([h1,h2,h3]);

  // ìŠ¤íƒœê±° ë“±ì¥
  [h1,h2,h3].forEach((el, i)=>{
    setTimeout(()=>{
      el.classList.add('show','floaty');
    }, i*STAGGER_MS);
  });
}

/* ===== ì‹œì‘: ë¦¬ë³¸í’€ê¸° â†’ ì˜ìƒ ì¬ìƒ â†’ ì˜ìƒ ë â†’ í•˜íŠ¸ ë…¸ì¶œ ===== */
startBtn.addEventListener('click', async ()=>{
  // ì¤‘ì•™ ë²„íŠ¼ ìˆ¨ê¸°ê³ , ë¹„ë””ì˜¤ ë³´ì—¬ì£¼ê¸°
  startBtn.style.display = 'none';
  videoEl.style.display  = 'block';
  videoEl.src = VIDEO_SRC;
  videoEl.muted = true;
  videoEl.playsInline = true;

  try{
    await videoEl.play();
  }catch(err){
    // ìë™ì¬ìƒ ë§‰íˆë©´ íƒ­ì¹©ìœ¼ë¡œ ìœ ë„
    tapChip.style.display = 'block';
    const resume = async ()=>{
      tapChip.style.display = 'none';
      try{ await videoEl.play(); }catch(e){}
      tapChip.removeEventListener('click', resume);
      tapChip.removeEventListener('touchend', resume);
    };
    tapChip.addEventListener('click', resume, {once:true});
    tapChip.addEventListener('touchend', resume, {once:true});
  }
});

/* ì˜ìƒ ëë‚¬ì„ ë•Œë§Œ í•˜íŠ¸ ë…¸ì¶œ */
videoEl.addEventListener('ended', ()=>{
  revealHearts();
});

/* í˜¹ì‹œ ì˜ìƒì´ ì§§ì•„ ë ì´ë²¤íŠ¸ê°€ ìŠ¤í‚µë  ìƒí™© ëŒ€ë¹„(ë§‰í”„ ê·¼ì ‘ ê°ì§€) */
videoEl.addEventListener('timeupdate', ()=>{
  if (videoEl.duration && videoEl.currentTime >= videoEl.duration - 0.2){
    // í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ì´ë²¤íŠ¸ ì œê±°
    videoEl.dispatchEvent(new Event('ended'));
    videoEl.src = ''; // ì¤‘ë³µ ë°©ì§€
  }
});
</script>
</body>
</html>
