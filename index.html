<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ğŸ ë¦¬ë³¸ í’€ê¸° â€” ì‹œê°„ì°¨ ì˜¤í”ˆ</title>
<style>
  :root { color-scheme: dark; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html,body { margin:0; background:#000; overflow:hidden; font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif; }
  .stage { position:fixed; inset:0; }

  /* ë§¨ë’¤ ë ˆì´ì–´ */
  video, .poster {
    position:absolute; inset:0; width:100vw; height:100vh;
    object-fit:contain; background:#000; z-index:0;
    display:block;
  }
  .hide { display:none !important; }

  /* ğŸ€ ë¦¬ë³¸ í’€ê¸° ë²„íŠ¼(ìƒì ì¤‘ì•™ ìœ„) */
  #ribbon{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    padding:16px 22px; border-radius:16px;
    background:linear-gradient(135deg,#ff90c2,#ff68b5);
    color:#1a1020; font-weight:900; font-size:1.05rem;
    border:1px solid rgba(255,255,255,.22);
    box-shadow:0 10px 28px rgba(0,0,0,.45), inset 0 0 22px rgba(255,255,255,.25);
    z-index:5; user-select:none; cursor:pointer;
    animation:bob 1.6s ease-in-out infinite;
  }
  #ribbon:active{ transform:translate(-50%,-50%) scale(.98); }
  @keyframes bob{ 0%,100%{ transform:translate(-50%,-50%) translateY(0); } 50%{ transform:translate(-50%,-50%) translateY(-6px); } }

  /* í•˜íŠ¸ ë²„íŠ¼ ë°” (í•˜ë‹¨ë³´ë‹¤ ì‚´ì§ ìœ„) */
  .heart-bar{
    position:absolute; left:0; right:0;
    bottom:calc(env(safe-area-inset-bottom,0px) + 140px);
    display:flex; gap:12px; justify-content:center; align-items:flex-end;
    padding:0 16px; z-index:10; pointer-events:none;
  }
  /* ë²„íŠ¼ */
  .btn-heart{
    position:relative;
    display:inline-flex; align-items:center; justify-content:center;
    min-width:120px; padding:12px 16px;
    border-radius:999px; font-weight:900; letter-spacing:.3px;
    color:#0c1020; text-decoration:none; user-select:none;
    border:1px solid rgba(255,255,255,.14);
    box-shadow:0 8px 24px rgba(0,0,0,.35), inset 0 0 18px rgba(255,255,255,.15);
    transform:translateY(28px); opacity:0; filter:saturate(1.08);
    transition:transform .6s cubic-bezier(.2,.8,.2,1), opacity .6s cubic-bezier(.2,.8,.2,1);
    pointer-events:auto;
  }
  .btn-heart.show{ opacity:1; transform:translateY(0); }
  .btn-heart:active{ transform:translateY(0) scale(.98); }

  .pink  { background:linear-gradient(45deg,#ff90c2,#ff68b5); }
  .orange{ background:linear-gradient(45deg,#ffc076,#ff8a33); }
  .blue  { background:linear-gradient(45deg,#7cc8ff,#3fa6ff); }

  /* ì ê¸ˆ ë°°ì§€ */
  .locked{ filter:grayscale(.15) brightness(.9); opacity:.7; cursor:not-allowed; }
  .locked .lock{
    position:absolute; left:50%; bottom:100%;
    transform:translate(-50%,-8px);
    display:inline-flex; gap:6px; align-items:center;
    padding:6px 10px; border-radius:10px;
    background:rgba(16,22,32,.95); color:#eaf1ff; font-weight:800; font-size:.78rem;
    border:1px solid rgba(255,255,255,.14);
    box-shadow:0 6px 18px rgba(0,0,0,.4);
  }
  .locked .lock b{ font-variant-numeric:tabular-nums; }

  @media (max-height:740px){
    .btn-heart{ min-width:110px; padding:10px 14px; }
    .heart-bar{ bottom:calc(env(safe-area-inset-bottom,0px) + 120px); gap:10px; }
  }
</style>
</head>
<body>
  <div class="stage">
    <!-- â¬‡â¬‡â¬‡ ì—¬ê¸° ë‘ ê°œ íŒŒì¼ëª…ë§Œ ë§ì¶°ì£¼ì„¸ìš” â¬‡â¬‡â¬‡ -->
    <!-- ì„ ë¬¼ë°•ìŠ¤ ì—¬ëŠ” ì˜ìƒ -->
    <video id="giftVideo" src="./gift_open.mp4" preload="auto" playsinline webkit-playsinline muted></video>
    <!-- ì˜ìƒ ë§ˆì§€ë§‰ í”„ë ˆì„(ë˜ëŠ” ê°™ì€ ê·¸ë¦¼) PNG í¬ìŠ¤í„° -->
    <img id="giftPoster" class="poster hide" src="./gift_poster.png" alt="gift poster"/>

    <!-- ë¦¬ë³¸ í’€ê¸° -->
    <button id="ribbon">ğŸ€ ë¦¬ë³¸ í’€ê¸°</button>

    <!-- í•˜íŠ¸ ë²„íŠ¼ë“¤ -->
    <div id="bar" class="heart-bar" aria-label="ì„ ë¬¼ ì„ íƒ">
      <a class="btn-heart pink"   href="./scene1.html"   id="btn1" aria-label="ì²«ë²ˆì§¸">ğŸ’–</a>
      <a class="btn-heart orange" href="./scene2.html"   id="btn2" aria-label="ë‘ë²ˆì§¸">ğŸ§¡ğŸ§¡</a>
      <a class="btn-heart blue"   href="./scene3_4.html" id="btn3" aria-label="ì„¸ë²ˆì§¸">ğŸ’™ğŸ’™ğŸ’™</a>
    </div>
  </div>

<script>
  /* ========= ì„¤ì •(ì—¬ê¸°ë§Œ ë°”ê¿”ìš”) ========= */
  // ì ê¸ˆ í•´ì œ ì‹œê°„(ì´ˆ): ì¦‰ì‹œ / 1ì‹œê°„ / 2ì‹œê°„ (í…ŒìŠ¤íŠ¸ëŠ” [0,10,20])
  const UNLOCK_OFFSETS = [0, 3600, 7200];
  // ë²„íŠ¼ ë“±ì¥ ê°„ê²©(ms): 0ms, 1000ms, 2000ms
  const STAGGER_MS = 400;

  const video  = document.getElementById('giftVideo');
  const poster = document.getElementById('giftPoster');
  const ribbon = document.getElementById('ribbon');
  const bar    = document.getElementById('bar');
  const btns   = [document.getElementById('btn1'), document.getElementById('btn2'), document.getElementById('btn3')];

  const KEY_START = 'giftStartAt';
  const KEY_SEEN  = 'giftSeenOnce';

  const nowSec = () => Math.floor(Date.now()/1000);
  const getStartAt = () => {
    const v = localStorage.getItem(KEY_START);
    return v ? parseInt(v,10) : null;
  };
  const setStartAt = (t) => localStorage.setItem(KEY_START, String(t));

  /* ì´ˆê¸° ì§„ì… ë¡œì§:
     - ì´ë¯¸ ë³¸ ì  ìˆìœ¼ë©´(ì”¬ ê°”ë‹¤ê°€ ëŒì•„ì˜´ í¬í•¨) â†’ ë°”ë¡œ í¬ìŠ¤í„°+í•˜íŠ¸ */
  window.addEventListener('DOMContentLoaded', () => {
    const seen = localStorage.getItem(KEY_SEEN) === '1';
    if (seen) {
      // ë¹„ë””ì˜¤ ì•ˆ ë³´ì—¬ì£¼ê³  í¬ìŠ¤í„°ë¡œ
      showPosterImmediate();
      revealButtonsStaggered();
      scheduleLocks();
    } else {
      // ì²« ë°©ë¬¸: ë¦¬ë³¸ ë³´ì´ê¸°, ë¹„ë””ì˜¤ëŠ” ìˆ¨ê¹€ ìƒíƒœ(í´ë¦­ ì‹œ ì¬ìƒ)
      video.classList.remove('hide');
      poster.classList.add('hide');
      ribbon.classList.remove('hide');
    }
  });

  // ë¦¬ë³¸ í´ë¦­ â†’ ì˜ìƒ ì¬ìƒ ì‹œì‘
  ribbon.addEventListener('click', () => {
    ribbon.classList.add('hide');
    video.muted = true; video.playsInline = true;
    video.play().catch(() => {
      // ìë™ì¬ìƒ ì‹¤íŒ¨ ì‹œ í•œ ë²ˆ ë” ëˆŒëŸ¬ë‹¬ë¼ëŠ” ë¬¸êµ¬ë¡œ êµì²´
      ribbon.textContent = 'â–¶ ì˜ìƒ ì‹œì‘í•˜ê¸°';
      ribbon.classList.remove('hide');
    });
  });

  // ì˜ìƒ ì¢…ë£Œ ì²˜ë¦¬(ê¹œë¹¡ì„ ì—†ì´ í¬ìŠ¤í„°+í•˜íŠ¸)
  let finished = false;
  function finishToPoster() {
    if (finished) return; finished = true;

    // ì‹œì‘ ê¸°ì¤€ì‹œê° ì €ì¥(ì—†ìœ¼ë©´ë§Œ)
    if (!getStartAt()) setStartAt(nowSec());
    localStorage.setItem(KEY_SEEN, '1');

    // í¬ìŠ¤í„° ë¯¸ë¦¬ ë¡œë”© í›„ êµì²´(ê¹œë¹¡ì„ ë°©ì§€)
    const img = new Image();
    img.onload = () => {
      poster.classList.remove('hide');
      video.classList.add('hide');
      revealButtonsStaggered();
      scheduleLocks();
    };
    img.onerror = () => {
      // í¬ìŠ¤í„° ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì˜ìƒ í”„ë ˆì„ì„ ê°€ë¦° ìƒíƒœë¡œ ë²„íŠ¼ë§Œ ë„ì›€
      poster.classList.add('hide');
      revealButtonsStaggered();
      scheduleLocks();
    };
    img.src = poster.src;
  }
  video.addEventListener('ended', finishToPoster, { once:true });
  video.addEventListener('timeupdate', () => {
    if (!finished && video.duration && video.currentTime >= video.duration - 0.15) finishToPoster();
  });
  video.addEventListener('error', finishToPoster, { once:true });

  // ì¬ë°©ë¬¸ ì¦‰ì‹œ í¬ìŠ¤í„°ë¡œ ë³´ì´ëŠ” í•¨ìˆ˜
  function showPosterImmediate(){
    video.classList.add('hide');
    poster.classList.remove('hide');
    ribbon.classList.add('hide');
  }

  // ë²„íŠ¼ â€˜ë‘ë‘¥ì‹¤â€™ ë“±ì¥(1ì´ˆ ê°„ê²©)
  function revealButtonsStaggered(){
    bar.style.pointerEvents = 'none';
    btns.forEach((b,i)=>{
      setTimeout(()=> b.classList.add('show'), i*STAGGER_MS);
    });
    setTimeout(()=> bar.style.pointerEvents = 'auto', STAGGER_MS*btns.length + 100);
  }

  // ì ê¸ˆ/í•´ì œ & ì¹´ìš´íŠ¸ë‹¤ìš´
  function lockButton(btn){
    if (btn.dataset.locked === '1') return;
    btn.dataset.locked='1';
    btn.classList.add('locked');
    let badge = btn.querySelector('.lock');
    if (!badge){
      badge = document.createElement('span');
      badge.className='lock';
      badge.innerHTML='ğŸ”’ <b>--:--:--</b>';
      btn.appendChild(badge);
    }
    btn.addEventListener('click', preventLocked, { capture:true });
  }
  function unlockButton(btn){
    if (btn.dataset.locked !== '1') return;
    btn.dataset.locked='0';
    btn.classList.remove('locked');
    const badge = btn.querySelector('.lock');
    if (badge) badge.remove();
    btn.removeEventListener('click', preventLocked, { capture:true });
    // ì‚´ì§ ë°˜ì§
    btn.style.boxShadow='0 10px 28px rgba(0,0,0,.4), inset 0 0 22px rgba(255,255,255,.25)';
    setTimeout(()=>{ btn.style.boxShadow='0 8px 24px rgba(0,0,0,.35), inset 0 0 18px rgba(255,255,255,.15)'; }, 250);
  }
  function preventLocked(e){ e.preventDefault(); e.stopPropagation(); }

  function pad(n){ return String(n).padStart(2,'0'); }
  function formatHMS(sec){
    const h = Math.floor(sec/3600), m=Math.floor((sec%3600)/60), s=sec%60;
    return `${pad(h)}:${pad(m)}:${pad(s)}`;
  }

  function scheduleLocks(){
    let startAt = getStartAt();
    if (!startAt){ startAt = nowSec(); setStartAt(startAt); }

    // ì´ˆê¸° ìƒíƒœ
    btns.forEach((btn,i)=>{
      const remain = startAt + UNLOCK_OFFSETS[i] - nowSec();
      if (remain <= 0) unlockButton(btn);
      else {
        lockButton(btn);
        const badge = btn.querySelector('.lock b'); if (badge) badge.textContent = formatHMS(remain);
      }
    });

    // 1ì´ˆë§ˆë‹¤ ì¹´ìš´íŠ¸ë‹¤ìš´/í•´ì œ
    setInterval(()=>{
      const now = nowSec();
      btns.forEach((btn,i)=>{
        const remain = startAt + UNLOCK_OFFSETS[i] - now;
        if (remain <= 0) unlockButton(btn);
        else if (btn.dataset.locked === '1'){
          const badge = btn.querySelector('.lock b'); if (badge) badge.textContent = formatHMS(remain);
        }
      });
    }, 1000);
  }
</script>
</body>
</html>
