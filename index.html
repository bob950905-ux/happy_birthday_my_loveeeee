<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ğŸ ë¦¬ë³¸ í’€ê¸° â€” ì‹œê°„ì°¨ ì˜¤í”ˆ</title>
<style>
  :root { color-scheme: dark; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html,body { margin:0; background:#000; overflow:hidden; font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif; }
  .stage { position:fixed; inset:0; }

  /* ë°°ê²½ ì˜ìƒ/ì´ë¯¸ì§€ (í•­ìƒ ë§¨ ë’¤) */
  video, img.bg {
    position:absolute; inset:0; width:100vw; height:100vh;
    object-fit:contain; background:#000; z-index:0;
  }

  /* ğŸ€ ë¦¬ë³¸ í’€ê¸° (ì¤‘ì•™) */
  #hint{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
    padding:16px 22px; border-radius:16px;
    background:linear-gradient(135deg,#ff90c2,#ff68b5);
    color:#1a1020; font-weight:900; font-size:1.05rem;
    border:1px solid rgba(255,255,255,.22);
    box-shadow:0 10px 28px rgba(0,0,0,.45), inset 0 0 22px rgba(255,255,255,.25);
    z-index:5; user-select:none;
    animation:bob 1.6s ease-in-out infinite;
  }
  #hint:active{ transform:translate(-50%,-50%) scale(.98); }
  @keyframes bob{
    0%,100%{ transform:translate(-50%,-50%) translateY(0); }
    50%    { transform:translate(-50%,-50%) translateY(-6px); }
  }

  /* í•˜íŠ¸ ë²„íŠ¼ ë°” (í•˜ë‹¨ë³´ë‹¤ â€˜ì¡°ê¸ˆ ìœ„â€™) */
  .heart-bar{
    position:fixed; left:0; right:0;
    bottom:calc(env(safe-area-inset-bottom,0px) + 140px);
    display:flex; gap:12px; justify-content:center; align-items:flex-end;
    padding:0 16px; z-index:10; pointer-events:none; /* ì• ë‹ˆ ì „ ì˜¤í„°ì¹˜ ë°©ì§€ */
  }

  /* ë²„íŠ¼ ê¸°ë³¸ */
  .btn-heart{
    position:relative;
    display:inline-flex; align-items:center; justify-content:center;
    min-width:120px; padding:12px 16px;
    border-radius:999px; font-weight:900; letter-spacing:.3px;
    color:#0c1020; text-decoration:none; user-select:none;
    border:1px solid rgba(255,255,255,.14);
    box-shadow:0 8px 24px rgba(0,0,0,.35), inset 0 0 18px rgba(255,255,255,.15);
    transform:translateY(20px); opacity:0; filter:saturate(1.08);
    transition:transform .6s ease-out, opacity .6s ease-out, box-shadow .2s ease;
    pointer-events:auto;
  }
  .btn-heart:active{ transform:translateY(0) scale(.98); }

  /* ìƒ‰ìƒ (í•‘í¬ / ì˜¤ë Œì§€ / ë¸”ë£¨) */
  .pink  { background:linear-gradient(45deg,#ff90c2,#ff68b5); }
  .orange{ background:linear-gradient(45deg,#ffc076,#ff8a33); }
  .blue  { background:linear-gradient(45deg,#7cc8ff,#3fa6ff); }

  /* ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ */
  .show { opacity:1; transform:translateY(0); }

  /* ì ê¸ˆ ìƒíƒœ */
  .locked{
    filter:grayscale(.15) brightness(.9);
    opacity:.65;
    cursor:not-allowed;
  }
  .locked .lock{
    position:absolute; inset:auto 10px 100%;
    display:inline-flex; gap:6px; align-items:center;
    transform:translateY(-6px);
    padding:6px 10px; border-radius:10px;
    background:rgba(16,22,32,.9); color:#eaf1ff; font-weight:800; font-size:.78rem;
    border:1px solid rgba(255,255,255,.14);
  }
  .locked .lock b{ font-variant-numeric:tabular-nums; }

  /* ì¢ì€ ë†’ì´ ëŒ€ì‘ */
  @media (max-height:740px){
    .btn-heart{ min-width:110px; padding:10px 14px; }
    .heart-bar{ bottom:calc(env(safe-area-inset-bottom,0px) + 120px); gap:10px; }
  }
</style>
</head>
<body>
  <div class="stage">
    <!-- ì˜ìƒ íŒŒì¼: gift_open.mp4 (ê°™ì€ í´ë”) -->
    <video id="vid" src="./gift_open.mp4" preload="auto" playsinline webkit-playsinline muted></video>
    <!-- ì¬ë°©ë¬¸ ì‹œ ì‚¬ìš©í•  ì„ íƒì  ìŠ¤í‹¸ ì´ë¯¸ì§€ íŒŒì¼ëª…(ìˆìœ¼ë©´ ìë™ ì‚¬ìš©ë¨): gift_open_end.png -->

    <div id="hint">ğŸ€ ë¦¬ë³¸ í’€ê¸°</div>

    <!-- í•˜ë‹¨ í•˜íŠ¸ ë²„íŠ¼ë“¤ -->
    <div id="bar" class="heart-bar" aria-label="ì„ ë¬¼ ì„ íƒ">
      <a class="btn-heart pink"   href="./scene1.html"   id="btn1" aria-label="ì²«ë²ˆì§¸">ğŸ’–</a>
      <a class="btn-heart orange" href="./scene2.html"   id="btn2" aria-label="ë‘ë²ˆì§¸">ğŸ§¡ğŸ§¡</a>
      <a class="btn-heart blue"   href="./scene3_4.html" id="btn3" aria-label="ì„¸ë²ˆì§¸">ğŸ’™ğŸ’™ğŸ’™</a>
    </div>
  </div>

<script>
  /* =========================
     ì„¤ì •ê°’ (ì—¬ê¸°ë§Œ ë°”ê¿”ë„ ë¨)
     ========================= */
  // ë²„íŠ¼ ë“±ì¥ íƒ€ì´ë°(ms): 0 / 3ì´ˆ / 6ì´ˆ
  const REVEAL_DELAYS = [0, 3000, 6000];

  // ì ê¸ˆ í•´ì œ ì˜¤í”„ì…‹(ì´ˆ): ì¦‰ì‹œ / 1ì‹œê°„ / 2ì‹œê°„
  // í…ŒìŠ¤íŠ¸ì‹œ [0,10,20] ë“±ìœ¼ë¡œ ë°”ê¾¸ì„¸ìš”.
  const UNLOCK_OFFSETS = [0, 3600, 7200];

  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ë“¤
  const KEY_START_AT = 'giftStartAt';      // ì²« ì™„ë£Œ ê¸°ì¤€ì‹œê°„
  const KEY_INTRO_DONE = 'giftIntroDone';  // ì¸íŠ¸ë¡œ(ì˜ìƒ) ì™„ë£Œ ì—¬ë¶€

  /* ========================= */
  const vid  = document.getElementById('vid');
  const hint = document.getElementById('hint');
  const bar  = document.getElementById('bar');
  const btns = [
    document.getElementById('btn1'),
    document.getElementById('btn2'),
    document.getElementById('btn3')
  ];

  const nowSec = () => Math.floor(Date.now()/1000);
  const getStartAt = () => {
    const v = localStorage.getItem(KEY_START_AT);
    return v ? parseInt(v,10) : null;
  };
  const ensureStartAt = () => {
    let t = getStartAt();
    if(!t){
      t = nowSec();
      localStorage.setItem(KEY_START_AT, String(t));
    }
    return t;
  };

  /* --- ì¬ë°©ë¬¸ì¸ì§€ ì²´í¬: ì¬ë°©ë¬¸ì´ë©´ ì˜ìƒ ìŠ¤í‚µ --- */
  const introDone = localStorage.getItem(KEY_INTRO_DONE) === '1';
  if (introDone) {
    // íŒíŠ¸/ì˜ìƒ ê°ì¶¤
    hint.style.display = 'none';
    // ìŠ¤í‹¸ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ êµì²´ ì‚¬ìš© (gift_open_end.png)
    const still = new Image();
    still.className = 'bg';
    still.onload = () => {
      vid.remove();
      document.querySelector('.stage').prepend(still);
    };
    still.onerror = () => { /* ìŠ¤í‹¸ì´ ì—†ì–´ë„ ê·¸ëƒ¥ ë¬´ì‹œ */ };
    still.src = './gift_open_end.png';

    // ë²„íŠ¼ í‘œì‹œ + ì ê¸ˆ ìŠ¤ì¼€ì¤„ ì¦‰ì‹œ ì‹œì‘
    revealButtons();
    scheduleLocks();
  } else {
    // ìµœì´ˆ ë°©ë¬¸: ë¦¬ë³¸ í’€ê¸° ëˆŒëŸ¬ ì˜ìƒ ì¬ìƒ â†’ ëë‚˜ë©´ ë²„íŠ¼/ìŠ¤ì¼€ì¤„
    setupStart();
    wireEnd();
  }

  /* START: ì¤‘ì•™ ë¦¬ë³¸ í’€ê¸° íƒ­ ì‹œ ì¬ìƒ */
  function setupStart(){
    const start = ()=>{
      hint.style.display='none';
      vid.muted = true; vid.playsInline = true;
      vid.play().catch(()=>{
        hint.textContent = 'â–¶ ì˜ìƒ ì‹œì‘í•˜ê¸°';
        hint.style.display='block';
      });
      ['pointerdown','touchend','click'].forEach(ev=>document.removeEventListener(ev,start));
    };
    ['pointerdown','touchend','click'].forEach(ev=>{
      document.addEventListener(ev,start,{once:true,passive:true});
    });
  }

  /* ì˜ìƒ ëë‚˜ë©´ ë²„íŠ¼ ë“±ì¥ + ì ê¸ˆ ìŠ¤ì¼€ì¤„ ì‹œì‘ + ì¬ë°©ë¬¸ í”Œë˜ê·¸ ì €ì¥ */
  function wireEnd(){
    let done=false;
    const finish=()=>{
      if(done) return; done=true;

      // ì¬ë°©ë¬¸ ì‹œ ì˜ìƒ ëŒ€ì‹  ìŠ¤í‹¸ ê³ ì •
      const still = new Image();
      still.className = 'bg';
      still.onload = () => {
        vid.remove();
        document.querySelector('.stage').prepend(still);
      };
      still.onerror = () => { /* ìŠ¤í‹¸ ì—†ìœ¼ë©´ íŒ¨ìŠ¤ */ };
      still.src = './gift_open_end.png';

      revealButtons();
      scheduleLocks(); // ì‹œê°„ì°¨ ì˜¤í”ˆ
      localStorage.setItem(KEY_INTRO_DONE, '1'); // ë‹¤ìŒë¶€í„°ëŠ” ìŠ¤í‚µ
    };
    vid.addEventListener('ended', finish, { once:true });
    vid.addEventListener('timeupdate', ()=>{
      if(!done && vid.duration && vid.currentTime >= vid.duration - 0.2) finish();
    });
    vid.addEventListener('error', finish, { once:true }); // fallback
  }

  /* ë²„íŠ¼ ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ (íˆ­íˆ­íˆ­) */
  function revealButtons(){
    bar.style.pointerEvents = 'none';
    setTimeout(()=>btns[0].classList.add('show'), REVEAL_DELAYS[0]);
    setTimeout(()=>btns[1].classList.add('show'), REVEAL_DELAYS[1]);
    setTimeout(()=>btns[2].classList.add('show'), REVEAL_DELAYS[2]);
    setTimeout(()=>{ bar.style.pointerEvents='auto'; }, Math.max(...REVEAL_DELAYS)+200);
  }

  /* ì ê¸ˆ/í•´ì œ UI */
  function lockButton(btn){
    if(btn.dataset.locked === '1') return;
    btn.dataset.locked = '1';
    btn.classList.add('locked');

    let badge = btn.querySelector('.lock');
    if(!badge){
      badge = document.createElement('span');
      badge.className = 'lock';
      badge.innerHTML = 'ğŸ”’ <b>--:--:--</b>';
      btn.appendChild(badge);
    }

    btn.addEventListener('click', preventLocked, { capture:true });
  }
  function unlockButton(btn){
    if(btn.dataset.locked !== '1') return;
    btn.dataset.locked = '0';
    btn.classList.remove('locked');
    const badge = btn.querySelector('.lock');
    if(badge) badge.remove();
    btn.removeEventListener('click', preventLocked, { capture:true });
    btn.style.boxShadow = '0 10px 28px rgba(0,0,0,.4), inset 0 0 22px rgba(255,255,255,.25)';
    setTimeout(()=>{ btn.style.boxShadow='0 8px 24px rgba(0,0,0,.35), inset 0 0 18px rgba(255,255,255,.15)'; }, 250);
  }
  function preventLocked(e){
    e.preventDefault();
    e.stopPropagation();
    const btn = e.currentTarget;
    btn.style.transform = 'translateY(0) scale(.97)';
    setTimeout(()=>{ btn.style.transform = 'translateY(0)'; }, 120);
  }
  function formatHMS(sec){
    const h = Math.floor(sec/3600);
    const m = Math.floor((sec%3600)/60);
    const s = sec%60;
    const pad = n=>String(n).padStart(2,'0');
    return `${pad(h)}:${pad(m)}:${pad(s)}`;
  }

  /* ì‹œê°„ì°¨ ì˜¤í”ˆ ìŠ¤ì¼€ì¤„ */
  function scheduleLocks(){
    const startAt = ensureStartAt();

    // ì´ˆê¸° ìƒíƒœ
    btns.forEach((btn, i)=>{
      const unlockAt = startAt + UNLOCK_OFFSETS[i];
      const remain = unlockAt - nowSec();
      if(remain <= 0){
        unlockButton(btn);
      }else{
        lockButton(btn);
        const badge = btn.querySelector('.lock b');
        if(badge) badge.textContent = formatHMS(remain);
      }
    });

    // ì¹´ìš´íŠ¸ë‹¤ìš´
    setInterval(()=>{
      const now = nowSec();
      btns.forEach((btn, i)=>{
        const unlockAt = startAt + UNLOCK_OFFSETS[i];
        const remain = unlockAt - now;
        if(remain <= 0){
          unlockButton(btn);
        }else if(btn.dataset.locked === '1'){
          const badge = btn.querySelector('.lock b');
          if(badge) badge.textContent = formatHMS(remain);
        }
      });
    }, 1000);
  }
</script>
</body>
</html>
