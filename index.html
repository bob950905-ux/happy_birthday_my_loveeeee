<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ğŸ ë¦¬ë³¸ í’€ê¸° â€” ì‹œê°„ì°¨ ì˜¤í”ˆ</title>
<style>
:root{
  color-scheme: dark;
  /* ë¦¬ë³¸(íŒíŠ¸) ì„¸ë¡œ ìœ„ì¹˜: ìƒì ìœ„ì— ì˜¤ë„ë¡ í¼ì„¼íŠ¸ë¡œ ì¡°ì ˆ */
  --hint-top: 62%;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;background:#000;overflow:hidden;font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif}
.stage{position:fixed;inset:0}

/* í¬ìŠ¤í„°ëŠ” í•­ìƒ ê¹”ì•„ë‘ (ì¬ë°©ë¬¸/ëŒì•„ì˜¤ê¸° ìœ ì§€) */
.poster, video{
  position:absolute; inset:0; width:100vw; height:100vh;
  object-fit:contain; background:#000;
}
.poster{z-index:0}
video{z-index:1; opacity:1; transition:opacity .28s ease; will-change:opacity}

/* ğŸ€ ë¦¬ë³¸ í’€ê¸° ë²„íŠ¼(ìƒì ìœ„) */
#hint{
  position:fixed; left:50%; top:var(--hint-top); transform:translate(-50%,-50%);
  padding:14px 20px; border-radius:16px;
  background:linear-gradient(135deg,#ff90c2,#ff68b5);
  color:#1a1020; font-weight:900; font-size:1.02rem;
  border:1px solid rgba(255,255,255,.22);
  box-shadow:0 10px 28px rgba(0,0,0,.45), inset 0 0 22px rgba(255,255,255,.25);
  z-index:5; user-select:none; animation:bob 1.6s ease-in-out infinite;
}
#hint:active{transform:translate(-50%,-50%) scale(.98)}
@keyframes bob{0%,100%{transform:translate(-50%,-50%) translateY(0)}50%{transform:translate(-50%,-50%) translateY(-6px)}}

/* í•˜íŠ¸ ë²„íŠ¼ ë°”(í•˜ë‹¨ë³´ë‹¤ ì‚´ì§ ìœ„) */
.heart-bar{
  position:fixed; left:0; right:0;
  bottom:calc(env(safe-area-inset-bottom,0px) + 140px);
  display:flex; gap:12px; justify-content:center; align-items:flex-end;
  padding:0 16px; z-index:10; pointer-events:none;
}

/* í•˜íŠ¸ ë²„íŠ¼ */
.btn-heart{
  position:relative; display:inline-flex; align-items:center; justify-content:center;
  min-width:120px; padding:12px 16px; border-radius:999px;
  font-weight:900; letter-spacing:.3px; color:#0c1020; text-decoration:none; user-select:none;
  border:1px solid rgba(255,255,255,.14);
  box-shadow:0 8px 24px rgba(0,0,0,.35), inset 0 0 18px rgba(255,255,255,.15);
  opacity:0; transform:translateY(38px) scale(.94); filter:blur(3px) saturate(1.08);
  pointer-events:auto;
}
.pink{background:linear-gradient(45deg,#ff90c2,#ff68b5)}
.orange{background:linear-gradient(45deg,#ffc076,#ff8a33)}
.blue{background:linear-gradient(45deg,#7cc8ff,#3fa6ff)}
.btn-heart:active{transform:translateY(0) scale(.98)}

/* ë– ì˜¤ë¥´ëŠ” ëª¨ì…˜ */
@keyframes popRise{
  0%{opacity:0;transform:translateY(38px) scale(.94);filter:blur(3px)}
  60%{opacity:1;transform:translateY(-6px) scale(1.03);filter:blur(0)}
  100%{opacity:1;transform:translateY(0) scale(1);filter:blur(0)}
}
.show{animation:popRise 700ms cubic-bezier(.2,.7,.2,1.1) forwards}

/* ì ê¸ˆ ë°°ì§€ */
.locked{filter:grayscale(.15) brightness(.9);opacity:.65;cursor:not-allowed}
.locked .lock{
  position:absolute; inset:auto 10px 100%;
  display:inline-flex; gap:6px; align-items:center;
  transform:translateY(-6px);
  padding:6px 10px; border-radius:10px;
  background:rgba(16,22,32,.9); color:#eaf1ff; font-weight:800; font-size:.78rem;
  border:1px solid rgba(255,255,255,.14)
}
.locked .lock b{font-variant-numeric:tabular-nums}

/* ì‘ì€ í™”ë©´ */
@media (max-height:740px){
  .btn-heart{min-width:110px;padding:10px 14px}
  .heart-bar{bottom:calc(env(safe-area-inset-bottom,0px) + 120px);gap:10px}
  :root{--hint-top: 68%}
}
</style>
</head>
<body>
<div class="stage">
  <!-- âœ… ë§ˆì§€ë§‰ í”„ë ˆì„ ì´ë¯¸ì§€(ìƒì ìˆëŠ” í™”ë©´). íŒŒì¼ëª… ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨ -->
  <img id="poster" class="poster" src="./gift_open_last.png" alt="gift poster"/>

  <!-- ğŸ¥ ë¹„ë””ì˜¤: ì²˜ìŒì—ë§Œ ì¬ìƒ, ëë‚˜ë©´ ìì—°ìŠ¤ëŸ½ê²Œ í˜ì´ë“œì•„ì›ƒ -->
  <video id="vid" src="./gift_open.mp4" poster="./gift_open_last.png" preload="auto" playsinline webkit-playsinline muted></video>

  <!-- ğŸ€ ìƒì ìœ„ ë¦¬ë³¸ í’€ê¸° -->
  <div id="hint">ğŸ€ ë¦¬ë³¸ í’€ê¸°</div>

  <!-- ğŸ’–ğŸ§¡ğŸ©µ í•˜íŠ¸ ë²„íŠ¼ -->
  <div id="bar" class="heart-bar" aria-label="ì„ ë¬¼ ì„ íƒ">
    <a class="btn-heart pink"   href="./scene1.html"   id="btn1" aria-label="ì²«ë²ˆì§¸">ğŸ’–</a>
    <a class="btn-heart orange" href="./scene2.html"   id="btn2" aria-label="ë‘ë²ˆì§¸">ğŸ§¡ğŸ§¡</a>
    <a class="btn-heart blue"   href="./scene3_4.html" id="btn3" aria-label="ì„¸ë²ˆì§¸">ğŸ’™ğŸ’™ğŸ’™</a>
  </div>
</div>

<script>
/* ìš”ì†Œ */
const vid    = document.getElementById('vid');
const poster = document.getElementById('poster');
const hint   = document.getElementById('hint');
const bar    = document.getElementById('bar');
const btns   = [document.getElementById('btn1'), document.getElementById('btn2'), document.getElementById('btn3')];

/* ===== ì‚¬ìš©ì ì„¤ì • ===== */
/* í•˜íŠ¸ ë“±ì¥ ê°„ê²©(ms): 1ì´ˆ ê°„ê²© */
const REVEAL_DELAYS  = [0, 1000, 2000];
/* ì ê¸ˆ í•´ì œ(ì´ˆ): ì¦‰ì‹œ / 1ì‹œê°„ / 2ì‹œê°„ â€” í…ŒìŠ¤íŠ¸ëŠ” [0,10,20] */
const UNLOCK_OFFSETS = [0, 3600, 7200];

/* ìƒíƒœ ì €ì¥ í‚¤ */
const KEY_START = 'giftStartAt';
const nowSec    = () => Math.floor(Date.now()/1000);
const hasStarted = () => !!localStorage.getItem(KEY_START);

/* í¬ìŠ¤í„° ì„ ë¡œë”© */
(() => { const img=new Image(); img.src=poster.src; })();

/* ì²« ì§„ì…/ì¬ë°©ë¬¸ ë¶„ê¸° */
function setupStart(){
  if (hasStarted()){
    // â¬…ï¸ ì¬ë°©ë¬¸ ë˜ëŠ” ì”¬ì—ì„œ ëŒì•„ì˜´ â†’ ë¹„ë””ì˜¤ëŠ” ìˆ¨ê¸°ê³ , í¬ìŠ¤í„°+í•˜íŠ¸ ìœ ì§€
    showHomeState();
    return;
  }
  // ì²˜ìŒ ì§„ì… â†’ ë¦¬ë³¸ì´ ìƒì ìœ„ì— ë°”ë¡œ ë³´ì¸ë‹¤
  hint.style.display = 'block';
  const start = ()=>{
    hint.style.display='none';
    vid.muted = true; vid.playsInline = true;
    vid.play().catch(()=>{
      hint.textContent='â–¶ ì˜ìƒ ì‹œì‘í•˜ê¸°';
      hint.style.display='block';
    });
    ['pointerdown','touchend','click'].forEach(ev=>document.removeEventListener(ev,start));
  };
  ['pointerdown','touchend','click'].forEach(ev=>{
    document.addEventListener(ev,start,{once:true,passive:true});
  });
}

/* ì¬ë°©ë¬¸/ëŒì•„ì˜¤ê¸° ë•Œ í™ˆ ìƒíƒœ êµ¬ì„± */
function showHomeState(){
  // ë¹„ë””ì˜¤ëŠ” ë³´ì´ì§€ ì•Šê²Œ
  vid.style.display='none';
  // í¬ìŠ¤í„° ë°˜ë“œì‹œ ë³´ì´ê²Œ (í˜¹ì‹œ ìŠ¤íƒ€ì¼ì´ ë°”ë€Œì—ˆì„ ê²½ìš° ëŒ€ë¹„)
  poster.style.display='block';
  // ë¦¬ë³¸ì€ ìˆ¨ê¹€
  hint.style.display='none';
  // í•˜íŠ¸ ë…¸ì¶œ + ì ê¸ˆ ê°±ì‹ 
  ensurePosterVisible(()=>{ revealButtons(); scheduleLocks(); });
}

/* ì˜ìƒ ì¢…ë£Œ í›„ ì²˜ë¦¬ */
function wireEnd(){
  let done=false;
  const finish=()=>{
    if(done) return; done=true;
    if(!hasStarted()) localStorage.setItem(KEY_START, String(nowSec()));
    // ë¹„ë””ì˜¤ëŠ” ìì—°ìŠ¤ëŸ° í˜ì´ë“œì•„ì›ƒ
    vid.style.opacity='0';
    vid.addEventListener('transitionend',()=>{ vid.style.display='none'; },{once:true});
    ensurePosterVisible(()=>{ revealButtons(); scheduleLocks(); });
  };
  vid.addEventListener('ended', finish, {once:true});
  vid.addEventListener('timeupdate', ()=>{ if(!done && vid.duration && vid.currentTime >= vid.duration-0.1) finish(); });
  vid.addEventListener('error', finish, {once:true});
}

/* í¬ìŠ¤í„° ë¡œë“œ ë³´ì¥ (ê¹œë¹¡ì„ ë°©ì§€) */
function ensurePosterVisible(cb){
  if (poster.complete) { cb(); return; }
  poster.addEventListener('load', cb, {once:true});
}

/* í•˜íŠ¸ ë“±ì¥ ëª¨ì…˜ */
function revealButtons(){
  bar.style.pointerEvents='none';
  btns.forEach((btn,i)=>{ setTimeout(()=> btn.classList.add('show'), REVEAL_DELAYS[i]); });
  const last = Math.max(...REVEAL_DELAYS) + 800;
  setTimeout(()=> bar.style.pointerEvents='auto', last);
}

/* ì ê¸ˆ/í•´ì œ ë¡œì§ */
function lockButton(btn){
  if(btn.dataset.locked==='1') return;
  btn.dataset.locked='1'; btn.classList.add('locked');
  let badge=btn.querySelector('.lock');
  if(!badge){ badge=document.createElement('span'); badge.className='lock'; badge.innerHTML='ğŸ”’ <b>--:--:--</b>'; btn.appendChild(badge); }
  btn.addEventListener('click', preventLocked, {capture:true});
}
function unlockButton(btn){
  if(btn.dataset.locked!=='1') return;
  btn.dataset.locked='0'; btn.classList.remove('locked');
  const b=btn.querySelector('.lock'); if(b) b.remove();
  btn.removeEventListener('click', preventLocked, {capture:true});
  btn.style.boxShadow='0 10px 28px rgba(0,0,0,.4), inset 0 0 22px rgba(255,255,255,.25)';
  setTimeout(()=>{ btn.style.boxShadow='0 8px 24px rgba(0,0,0,.35), inset 0 0 18px rgba(255,255,255,.15)'; },240);
}
function preventLocked(e){ e.preventDefault(); e.stopPropagation(); const btn=e.currentTarget; btn.style.transform='translateY(0) scale(.97)'; setTimeout(()=>btn.style.transform='translateY(0)',120); }
function formatHMS(sec){ const h=Math.floor(sec/3600), m=Math.floor((sec%3600)/60), s=sec%60, p=n=>String(n).padStart(2,'0'); return `${p(h)}:${p(m)}:${p(s)}`; }

function scheduleLocks(){
  if(!hasStarted()) localStorage.setItem(KEY_START, String(nowSec()));
  const startAt = parseInt(localStorage.getItem(KEY_START),10);

  // ì´ˆê¸° ì ìš©
  btns.forEach((btn,i)=>{
    const unlockAt = startAt + UNLOCK_OFFSETS[i];
    const remain = unlockAt - nowSec();
    if(remain<=0){ unlockButton(btn); }
    else{
      lockButton(btn);
      const b=btn.querySelector('.lock b'); if(b) b.textContent = formatHMS(remain);
    }
  });

  // 1ì´ˆ ê°±ì‹ 
  setInterval(()=>{
    const now = nowSec();
    btns.forEach((btn,i)=>{
      const unlockAt = startAt + UNLOCK_OFFSETS[i];
      const remain = unlockAt - now;
      if(remain<=0){ unlockButton(btn); }
      else if(btn.dataset.locked==='1'){
        const b=btn.querySelector('.lock b'); if(b) b.textContent = formatHMS(remain);
      }
    });
  },1000);
}

/* ì‹¤í–‰ */
setupStart();
wireEnd();
</script>
</body>
</html>
