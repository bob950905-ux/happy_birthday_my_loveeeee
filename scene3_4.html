<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 3 + 4 (Ultimate Stability Fix)</title>
<style>
Â  /* ê¸°ë³¸ CSS í†µí•© */
Â  :root { color-scheme: dark; }
Â  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
Â  html,body { margin:0; background:#000; overflow:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, sans-serif; }
Â  .stage { position:fixed; inset:0; }
Â  video, img.bg {
Â  Â  position:absolute; inset:0; width:100vw; height:100vh; object-fit:contain; background:#000;
Â  }

Â  /* START ë²„íŠ¼ */
Â  #hint{
Â  Â  position:fixed; left:50%; top:14px; transform:translateX(-50%);
Â  Â  padding:10px 14px; border-radius:999px;
Â  Â  background:rgba(20,28,38,.92); color:#fff; font-weight:800;
Â  Â  border:1px solid rgba(255,255,255,.15); box-shadow:0 6px 22px rgba(0,0,0,.35);
Â  Â  z-index:10001; /* íƒ­ì¹©ë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
Â  Â  user-select:none;
Â  }

Â  /* ğŸš¨ íƒ­ì¹© CSS ìµœì¢… ìˆ˜ì •: position:absolute ì‚¬ìš© ë° z-index ìµœëŒ€ë¡œ ì„¤ì •í•˜ì—¬ ëˆŒë¦¬ëŠ” ê²ƒ ë³´ì¥ */
Â  .tapchip{
Â  Â  position:absolute; /* position:fixed ëŒ€ì‹  absolute ì‚¬ìš© */
Â  Â  left:50%; bottom:110px; transform:translateX(-50%);
Â  Â  display:none; width:auto; height:auto;
Â  Â  padding:15px 30px; border-radius:999px; background:rgba(20,28,38,.9);
Â  Â  color:#fff; font-weight:800; font-size:1.2rem;
Â  Â  border:1px solid rgba(255,255,255,.15); box-shadow:0 4px 18px rgba(0,0,0,.35);
Â  Â  z-index:10002; /* íƒ­ì¹©ì´ ëª¨ë“  ìš”ì†Œ ìœ„ì— ì˜¤ë„ë¡ ë³´ì¥ */
Â  Â  user-select:none;
Â  }
Â  .tapchip:active{ transform:translateX(-50%) scale(.96); }

Â  /* ëŒ€í™”ì°½ */
Â  .dialog{ position:fixed; left:0; right:0; bottom:24px; display:none; z-index:9999; }
Â  .dialog.show{ display:block !important; }
Â  .row{ display:flex; gap:12px; align-items:flex-end; width:100%; padding:0 18px; }
Â  .avatar{ width:58px; height:58px; border-radius:10px; image-rendering:pixelated; object-fit:cover; }
Â  .bubble{
Â  Â  flex:1; background:rgba(19,25,36,.92); border:1px solid rgba(255,255,255,.12);
Â  Â  border-radius:14px; padding:14px 14px 12px; color:#eaf1ff;
Â  Â  box-shadow:0 6px 22px rgba(0,0,0,.35);
Â  }
Â  .name{ font-size:.92rem; font-weight:800; opacity:.9; margin-bottom:6px; }
Â  .line{ font-size:1.06rem; font-weight:700; line-height:1.55; }
Â  .center{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
Â  .btn{
Â  Â  display:inline-flex; align-items:center; justify-content:center;
Â  Â  padding:11px 14px; border-radius:12px; font-weight:800; font-size:.98rem;
Â  Â  background:#30435f; color:#fff; border:1px solid rgba(255,255,255,.12);
Â  Â  text-decoration:none; min-width:180px;
Â  }
Â  .btn:active{ transform:translateY(1px); }

Â  /* í•˜íŠ¸ ì´í™íŠ¸ */
Â  .hearts span{
Â  Â  position:absolute; pointer-events:none; left:0; top:0;
Â  Â  transform:translate(-50%,-50%); font-size:22px;
Â  Â  animation:fall 1.5s linear forwards;
Â  }
Â  @keyframes fall{
Â  Â  0%{ transform:translateY(-10vh) scale(1); opacity:1; }
Â  Â  100%{ transform:translateY(100vh) scale(.5); opacity:0; }
Â  }
</style>
</head>
<body>
Â  <div class="stage">
Â  Â  Â  Â  <video id="v1" src="./scene3_taei.mp4" preload="auto" playsinline webkit-playsinline muted></video>

Â  Â  Â  Â  <div id="hint">ğŸ¬ START!</div>
Â  Â  <div id="tap"Â  class="tapchip">íƒ­!</div>

Â  Â  <div id="dialog" class="dialog">
Â  Â  Â  <div class="row">
Â  Â  Â  Â  <img id="avatar" class="avatar" src="./assets/avatar_seongwoo.png" alt="">
Â  Â  Â  Â  <div class="bubble">
Â  Â  Â  Â  Â  <div id="name" class="name">ì„±ìš°</div>
Â  Â  Â  Â  Â  <div id="line" class="line"></div>
Â  Â  Â  Â  Â  <div id="btns" class="center"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="hearts" class="hearts"></div>
Â  </div>

<script>
/* ===== ì—˜ë¦¬ë¨¼íŠ¸ ===== */
const v1Â  Â  = document.getElementById('v1');
const hintÂ  = document.getElementById('hint');
const tapÂ  Â = document.getElementById('tap');
const dialog= document.getElementById('dialog');
const avatar= document.getElementById('avatar');
const nameEl= document.getElementById('name');
const lineÂ  = document.getElementById('line');
const btnsÂ  = document.getElementById('btns');
const hearts= document.getElementById('hearts');

/* ===== íƒ­ì¹© ì œì–´ (ì „ì—­ 1íšŒì„±) ===== */
let tapAction=null, tapGuard=false;
function setTap(next){ tapAction=next; tap.style.display='inline-flex'; }
function clearTap(){ tapAction=null; tap.style.display='none'; }
function fireTap(){
Â  if (tapGuard) return;
Â  tapGuard=true; setTimeout(()=>tapGuard=false,160);
Â  const fn=tapAction; clearTap(); if (typeof fn==='function') fn();
}
tap.addEventListener('click',e=>{ if(e.target!==tap) return; e.preventDefault(); fireTap(); });
tap.addEventListener('touchend',e=>{ e.preventDefault(); fireTap(); });

/* ===== START ì²˜ë¦¬ (ìµœì¢… ì•ˆì •í™”) ===== */
function setupStart(){
Â  hint.style.display='block';
Â  v1.muted=true; v1.playsInline=true;
Â  
Â  const start=()=>{
Â  Â  // START ë²„íŠ¼ì„ ì´ë²¤íŠ¸ ë°œìƒ ì¦‰ì‹œ ë¬´ì¡°ê±´ ìˆ¨ê¹€
Â  Â  hint.style.display='none'; 
Â  Â  
Â  Â  v1.play().catch(error => {
Â  Â  Â  Â  // ì¬ìƒ ì‹¤íŒ¨ ì‹œ íƒ­ì¹©ì„ í‘œì‹œí•˜ì—¬ ë¹„ë””ì˜¤ ì¬ìƒì„ ìœ„í•œ íƒ­ ì„¤ì •
Â  Â  Â  Â  setTap(()=>v1.play());
Â  Â  });
Â  Â  
Â  Â  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
Â  Â  ['pointerdown','touchend','click'].forEach(ev => document.removeEventListener(ev, start));
Â  };
Â  
Â  // ìµœì´ˆ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
Â  ['pointerdown','touchend','click'].forEach(ev => document.addEventListener(ev, start, {once:true,passive:true}));
}

/* ===== ëŒ€í™” í‘œì‹œ ===== */
function say(who, face, text){
Â  dialog.classList.add('show');
Â  avatar.src = face;
Â  nameEl.textContent = who;
Â  line.textContent = text;
Â  btns.innerHTML = '';
}

/* ===== í•˜íŠ¸ ì´í™íŠ¸ ===== */
function heartBurst(){
Â  hearts.innerHTML='';
Â  for(let i=0;i<12;i++){
Â  Â  const s=document.createElement('span');
Â  Â  s.textContent='â¤';
Â  Â  s.style.left=(10 + Math.random()*80)+'vw';
Â  Â  s.style.top='-40px';
Â  Â  hearts.appendChild(s);
Â  }
Â  setTimeout(()=>hearts.innerHTML='',1600);
}

/* ===== ì”¬3 ëŒ€ì‚¬ í”Œë¡œìš° ===== */
function runScene3(){
Â  // 1) ì„±ìš°
Â  say('ì„±ìš°','./assets/avatar_seongwoo.png','ì–´? íƒœì´ë‹¤~~~~~');
Â  setTap(()=>{
Â  Â  // 2) íƒœì´
Â  Â  say('íƒœì´','./assets/avatar_taei.png','ì•„ê°€, ìƒì¼ ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜í•´! ğŸ‚ ë„¤ê°€ ì´ë ‡ê²Œ í–‰ë³µí•´í•˜ëŠ” ê±° ë³´ë‹ˆê¹Œ ë‚˜ë„ ë„ˆë¬´ ì¢‹ì•„.');
Â  Â  setTap(()=>{
Â  Â  Â  // 3)
Â  Â  Â  say('íƒœì´','./assets/avatar_taei.png','ê·¸ë¦¬ê³ ... ë§ˆì§€ë§‰ ë‚´ ì„ ë¬¼ì€...... ë‘êµ¬ë‘êµ¬ë‘êµ¬ë‘êµ¬ë‘êµ¬ğŸ¥');
Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  // 4)
Â  Â  Â  Â  say('íƒœì´','./assets/avatar_taei.png','ë°”ë¡œ ë‚˜ì•¼!!! ğŸ’–');
Â  Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  Â  // 5)
Â  Â  Â  Â  Â  say('íƒœì´','./assets/avatar_taei.png','íˆíˆ ë‚˜ë„ ì„ ë¬¼ì´ê³ ! ì§„ì§œ ë§ˆì§€ë§‰ ì„ ë¬¼ì€.....!');
Â  Â  Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  Â  Â  dialog.classList.remove('show');
Â  Â  Â  Â  Â  Â  playScene4();
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  });
Â  });
}

/* ===== ì”¬4: ì˜ìƒ ì¬ìƒ í›„ í›„ì† ëŒ€ì‚¬ ===== */
let v2=null;
function playScene4(){
Â  // ì”¬4 ë¹„ë””ì˜¤ ì‚½ì…
Â  v2=document.createElement('video');
Â  v2.src='./scene4_ticket.mp4';
Â  v2.playsInline=true; v2.muted=true; v2.preload='auto';
Â  Object.assign(v2.style,{ position:'absolute', inset:'0', width:'100vw', height:'100vh', objectFit:'contain', background:'#000' });
Â  document.querySelector('.stage').appendChild(v2);

Â  // ì”¬3 ë¹„ë””ì˜¤ ì œê±°
Â  if (v1.parentNode) v1.parentNode.removeChild(v1);

Â  // ì¬ìƒ
Â  v2.play().catch(()=> setTap(()=>v2.play()) );

Â  // ì˜ìƒ ì¢…ë£Œ/ë§‰í”„ë ˆì„ ì²˜ë¦¬
Â  let done=false;
Â  const finish=()=>{
Â  Â  if(done) return; done=true;

Â  Â  // ë°°ê²½ ê³ ì • (ë§‰í”„ë ˆì„ PNGê°€ ìˆìœ¼ë©´ êµì²´)
Â  Â  const bg = document.createElement('img');
Â  Â  bg.className='bg';
Â  Â  bg.src = v2.src.replace('.mp4','.png');
Â  Â  bg.onerror = ()=>{ /* png ì—†ìœ¼ë©´ ê·¸ëƒ¥ ë¬´ì‹œ */ };
Â  Â  document.querySelector('.stage').appendChild(bg);

Â  Â  if (v2.parentNode) v2.parentNode.removeChild(v2);
Â  Â  v2=null;

Â  Â  // 7) íƒœì´ ìë™ ëŒ€ì‚¬
Â  Â  say('íƒœì´','./assets/avatar_taei.png','ìš°ë¦¬ ê°™ì´ ë– ë‚˜ì, ìê¸°ì•¼! âœˆï¸');

Â  Â  // 8) íƒ­ â†’ ì„±ìš° ëŒ€ì‚¬
Â  Â  setTap(()=>{
Â  Â  Â  say('ì„±ìš°','./assets/avatar_seongwoo.png','í—... ì™„ì „ ê°ë™ì´ì•¼. ë‚´ ë§ˆìŒì€ ì´ë¯¸ ì¶œë°œí–ˆëŠ”ë°?');

Â  Â  Â  // 9) íƒ­ â†’ ì„ íƒì§€ ë²„íŠ¼
Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  clearTap();
Â  Â  Â  Â  const o=document.createElement('a'); o.className='btn'; o.textContent='ê³ ë¯¼ì€ ë¬´ìŠ¨! ë‹¹ì¥ íƒœì´ ì† ì¡ê³  ë– ë‚ ë˜~ ğŸ’–';
Â  Â  Â  Â  const x=document.createElement('a'); x.className='btn'; x.textContent='ì ê¹! ë„ˆë¬´ ê°‘ì‘ìŠ¤ëŸ¬ì›Œ... ë‹¤ìŒì— ê°ˆë˜ìš”! ğŸ˜­';
Â  Â  Â  Â  btns.append(o,x);

Â  Â  Â  Â  // O ì„ íƒ
Â  Â  Â  Â  o.addEventListener('click', e=>{
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  say('íƒœì´','./assets/avatar_taei.png','íƒœì´í•œí…Œ ë½€ë½€~ğŸ’‹ ì™„ë²½í•œ ì„ íƒ! ìš°ë¦¬ ê°€ì„œ ë§›ìˆëŠ” ê±° ì”ëœ© ë¨¹ê³  ì˜¤ì~!');
Â  Â  Â  Â  Â  heartBurst();
Â  Â  Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  Â  Â  clearTap();
Â  Â  Â  Â  Â  Â  const home=document.createElement('a');
Â  Â  Â  Â  Â  Â  home.href='./index.html';
Â  Â  Â  Â  Â  Â  home.className='btn';
Â  Â  Â  Â  Â  Â  home.textContent='ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°';
Â  Â  Â  Â  Â  Â  btns.appendChild(home);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  },{once:true});

Â  Â  Â  Â  // X ì„ íƒ
Â  Â  Â  Â  x.addEventListener('click', e=>{
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  say('íƒœì´','./assets/avatar_taei.png','ë„ˆë¬´ ìŠ¬í¬ìš” í‘í‘ ğŸ¥º ë‹¤ìŒì—” ê¼­ ê°™ì´ ê°€ì~ ì•½ì†ì´ì•¼!');
Â  Â  Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  Â  Â  clearTap();
Â  Â  Â  Â  Â  Â  const home=document.createElement('a');
Â  Â  Â  Â  Â  Â  home.href='./index.html';
Â  Â  Â  Â  Â  Â  home.className='btn';
Â  Â  Â  Â  Â  Â  home.textContent='ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°';
Â  Â  Â  Â  Â  Â  btns.appendChild(home);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  },{once:true});
Â  Â  Â  });
Â  Â  });
Â  };

Â  v2.addEventListener('ended', finish, {once:true});
Â  v2.addEventListener('timeupdate', ()=>{
Â  Â  if(!done && v2.duration && v2.currentTime >= v2.duration - 0.2) finish();
Â  });
}

/* ===== ì‹œì‘ ===== */
setupStart();
v1.addEventListener('ended', runScene3, {once:true});
</script>
</body>
</html>
