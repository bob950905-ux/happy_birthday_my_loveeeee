<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>‚ù§Ô∏èÏ¢ãÏïÑÌï¥‚ù§Ô∏è</title>
<style>
:root { color-scheme: dark; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html,body { margin:0; background:#000; overflow:hidden; font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif; }
.stage { position:fixed; inset:0; }

/* ÎπÑÎîîÏò§ Î∞è PNG */
video, img.bg {
  position:absolute; inset:0; width:100vw; height:100vh;
  object-fit:contain; background:#000; z-index:0!important;
}

/* START */
#hint{
  position:fixed; left:50%; top:14px; transform:translateX(-50%);
  padding:10px 14px; border-radius:999px;
  background:rgba(20,28,38,.92); color:#fff; font-weight:800;
  border:1px solid rgba(255,255,255,.15);
  box-shadow:0 6px 22px rgba(0,0,0,.35);
  z-index:10001; user-select:none;
}

/* ÌÉ≠Ïπ© */
.tapchip{
  position:fixed!important;
  left:50%; bottom:calc(env(safe-area-inset-bottom,0px) + 110px);
  transform:translateX(-50%);
  display:none;
  padding:15px 30px; border-radius:999px;
  background:rgba(20,28,38,.9); color:#fff;
  font-weight:800; font-size:1.1rem;
  border:1px solid rgba(255,255,255,.15);
  box-shadow:0 4px 18px rgba(0,0,0,.35);
  z-index:2147483647!important;
  white-space:nowrap;
}
.tapchip:active{transform:translateX(-50%) scale(.96);}

/* ÎåÄÌôîÏ∞Ω */
.dialog{
  position:fixed; left:0; right:0;
  bottom:calc(env(safe-area-inset-bottom,0px) + 20px);
  display:none; z-index:2147483000!important;
  pointer-events:none;
}
.dialog.show{ display:block!important; }
.row{
  display:flex; gap:10px; align-items:flex-end;
  padding:0 14px; width:100%; max-width:960px; margin:0 auto;
}
.avatar{ width:46px; height:46px; border-radius:10px; object-fit:cover; }
.bubble{
  pointer-events:auto; flex:1; max-width:92vw; max-height:30vh; overflow:auto;
  background:rgba(19,25,36,.92); border:1px solid rgba(255,255,255,.12);
  border-radius:14px; padding:10px 12px; color:#eaf1ff;
  box-shadow:0 6px 22px rgba(0,0,0,.35);
}
.name{ font-weight:800; opacity:.9; margin-bottom:4px; font-size:.9rem; }
.line{ font-weight:700; font-size:1rem; line-height:1.5; }
.center{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
.btn{
  pointer-events:auto;
  display:inline-flex; align-items:center; justify-content:center;
  padding:10px 12px; border-radius:12px; font-weight:800;
  font-size:.95rem;
  background:#30435f; color:#fff;
  border:1px solid rgba(255,255,255,.12);
  text-decoration:none; min-width:160px;
}
.btn:active{ transform:translateY(1px); }
</style>
</head>
<body>
<div class="stage">
  <video id="v1" src="./scene3_taei.mp4" preload="auto" playsinline webkit-playsinline muted></video>
  <div id="hint">üé¨ START!</div>
  <div id="dialog" class="dialog">
    <div class="row">
      <img id="avatar" class="avatar" src="./assets/avatar_seongwoo.png" alt="">
      <div class="bubble">
        <div id="name" class="name">ÏÑ±Ïö∞</div>
        <div id="line" class="line"></div>
        <div id="btns" class="center"></div>
      </div>
    </div>
  </div>
  <div id="tap" class="tapchip">ÌÉ≠!</div>
  <div id="hearts" class="hearts"></div>
</div>

<script>
const v1=document.getElementById('v1');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');
const hearts=document.getElementById('hearts');

let tapAction=null,tapGuard=false;
function setTap(next){tapAction=next;tap.style.display='inline-flex';}
function clearTap(){tapAction=null;tap.style.display='none';}
function fireTap(){if(tapGuard)return;tapGuard=true;setTimeout(()=>tapGuard=false,160);const fn=tapAction;clearTap();if(typeof fn==='function')fn();}
tap.addEventListener('click',e=>{if(e.target!==tap)return;e.preventDefault();fireTap();});
tap.addEventListener('touchend',e=>{e.preventDefault();fireTap();});

function setupStart(){
  hint.style.display='block';
  v1.muted=true; v1.playsInline=true;
  const start=()=>{
    hint.style.display='none';
    v1.play().catch(()=> setTap(()=>v1.play()) );
    ['pointerdown','touchend','click'].forEach(ev=>document.removeEventListener(ev,start));
  };
  ['pointerdown','touchend','click'].forEach(ev=>document.addEventListener(ev,start,{once:true,passive:true}));
}

function say(who,face,text){
  dialog.classList.add('show');
  avatar.src=face; nameEl.textContent=who; line.textContent=text; btns.innerHTML='';
}

function heartBurst(){
  hearts.innerHTML='';
  for(let i=0;i<12;i++){
    const s=document.createElement('span');
    s.textContent='‚ù§';
    s.style.left=(10+Math.random()*80)+'vw';
    s.style.top='-40px';
    s.style.position='absolute';
    s.style.animation='fall 1.5s linear forwards';
    hearts.appendChild(s);
  }
  setTimeout(()=>hearts.innerHTML='',1600);
}

/* ===== Scene 3 ===== */
function runScene3(){
  say('ÏÑ±Ïö∞','./assets/avatar_seongwoo.png','Ïñ¥? ÌÉúÏù¥Îã§~~~~~');
  setTap(()=>{
    say('ÌÉúÏù¥','./assets/avatar_taei.png','ÏûêÍ∞∏, ÏÉùÏùº ÏßÑÏã¨ÏúºÎ°ú Ï∂ïÌïòÌï¥! üéÇ ÎÑ§Í∞Ä Ïù¥Î†áÍ≤å ÌñâÎ≥µÌï¥ÌïòÎäî Í±∞ Î≥¥ÎãàÍπå ÎÇòÎèÑ ÎÑàÎ¨¥ Ï¢ãÏïÑ.');
    setTap(()=>{
      say('ÌÉúÏù¥','./assets/avatar_taei.png','Í∑∏Î¶¨Í≥†... ÎßàÏßÄÎßâ ÎÇ¥ ÏÑ†Î¨ºÏùÄ...... ÎëêÍµ¨ÎëêÍµ¨ÎëêÍµ¨ÎëêÍµ¨ÎëêÍµ¨ü•Å');
      setTap(()=>{
        say('ÌÉúÏù¥','./assets/avatar_taei.png','Î∞îÎ°ú ÎÇòÏïº!!! üíñ');
        setTap(()=>{
          say('ÌÉúÏù¥','./assets/avatar_taei.png','ÌûàÌûà ÎÇòÎèÑ ÏÑ†Î¨ºÏù¥Í≥†! ÏßÑÏßú ÎßàÏßÄÎßâ ÏÑ†Î¨ºÏùÄ.....!');
          setTap(()=>{
            dialog.classList.remove('show');
            playScene4();
          });
        });
      });
    });
  });
}

/* ===== Scene 4 ===== */
let v2=null;
function playScene4(){
  const LAST_PNG='./scene4_ticket.png'; // ‚úÖ ÏòÅÏÉÅ ÎÅùÎÇòÎ©¥ Î≥¥Ïó¨Ï§Ñ PNG Ïù¥Î¶Ñ
  v2=document.createElement('video');
  v2.src='./scene4_ticket.mp4';
  v2.playsInline=true; v2.muted=true; v2.preload='auto';
  Object.assign(v2.style,{position:'absolute',inset:'0',width:'100vw',height:'100vh',objectFit:'contain',background:'#000',zIndex:'0'});
  document.querySelector('.stage').appendChild(v2);
  if(v1.parentNode)v1.parentNode.removeChild(v1);
  v2.play().catch(()=>setTap(()=>v2.play()));

  let done=false;
  const finish=()=>{
    if(done)return; done=true;

    const bg=document.createElement('img');
    bg.className='bg';
    bg.src=LAST_PNG;
    bg.onload=()=>{ say('ÌÉúÏù¥','./assets/avatar_taei.png','Ïö∞Î¶¨ Í∞ôÏù¥ Ï†úÏ£ºÎèÑ Í∞ÄÏûê, ÏûêÍ∏∞Ïïº! ‚úàÔ∏è'); };
    document.querySelector('.stage').appendChild(bg);

    if(v2.parentNode)v2.parentNode.removeChild(v2);
    v2=null;

    setTap(()=>{
      say('ÏÑ±Ïö∞','./assets/avatar_seongwoo.png','Ìóê... ÏôÑÏ†Ñ Í∞êÎèôÏù¥Ïïº. ÎÇ¥ ÎßàÏùåÏùÄ Ïù¥ÎØ∏ Ï∂úÎ∞úÌñàÎäîÎç∞?');
      setTap(()=>{
        clearTap();
        const o=document.createElement('a'); o.className='btn'; o.textContent='Í≥†ÎØºÏùÄ Î¨¥Ïä®! ÎãπÏû• ÌÉúÏù¥ ÏÜê Ïû°Í≥† Îñ†ÎÇ†Îûò~ üíñ';
        const x=document.createElement('a'); x.className='btn'; x.textContent='Ïû†Íπê! ÎÑàÎ¨¥ Í∞ëÏûëÏä§Îü¨Ïõå... Îã§ÏùåÏóê Í∞àÎûòÏöî! üò≠';
        btns.append(o,x);

        o.addEventListener('click',e=>{
          e.preventDefault();
          say('ÌÉúÏù¥','./assets/avatar_taei.png','ÌÉúÏù¥ÌïúÌÖå ÎΩÄÎΩÄ~üíã ÏôÑÎ≤ΩÌïú ÏÑ†ÌÉù! Ïö∞Î¶¨ Í∞ÄÏÑú ÎßõÏûàÎäî Í±∞ ÏûîÎú© Î®πÍ≥† Ïò§Ïûê~!');
          heartBurst();
          setTap(()=>{
            clearTap();
            const home=document.createElement('a');
            home.href='./index.html';
            home.className='btn';
            home.textContent='Î©îÏù∏ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞';
            btns.appendChild(home);
          });
        },{once:true});

        x.addEventListener('click',e=>{
          e.preventDefault();
          say('ÌÉúÏù¥','./assets/avatar_taei.png','ÎÑàÎ¨¥ Ïä¨Ìè¨Ïöî ÌùëÌùë ü•∫ Îã§ÏùåÏóî Íº≠ Í∞ôÏù¥ Í∞ÄÏûê~ ÏïΩÏÜçÏù¥Ïïº!');
          setTap(()=>{
            clearTap();
            const home=document.createElement('a');
            home.href='./index.html';
            home.className='btn';
            home.textContent='Î©îÏù∏ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞';
            btns.appendChild(home);
          });
        },{once:true});
      });
    });
  };

  v2.addEventListener('ended',finish,{once:true});
  v2.addEventListener('timeupdate',()=>{if(!done&&v2.duration&&v2.currentTime>=v2.duration-0.2)finish();});
}

setupStart();
v1.addEventListener('ended',runScene3,{once:true});
</script>
</body>
</html>
