<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 2 (Final Stable - Tapchip)</title>
<link rel="stylesheet" href="./assets/ui.css"/>

<style>
.dialog { display: none; } 
.dialog.show { 
    display: block !important; 
    z-index: 9999;
}
</style>
</head>
<body>
<div class="stage">
  <video id="vid" src="./scene2_wine.mp4" preload="auto" playsinline webkit-playsinline muted></video>
  <div class="hint" id="hint">ğŸ¬ START!</div>
  <div class="tapchip" id="tap">íƒ­!</div>
  <div class="dialog" id="dialog">
    <div class="row" id="row">
      <img class="avatar" id="avatar" src="./assets/avatar_seongwoo.png" alt="avatar"/>
      <div class="bubble" id="bubble">
        <div class="name" id="name">ì„±ìš°</div>
        <div class="line" id="line"></div>
        <div class="center" id="btns"></div>
      </div>
    </div>
  </div>
  <div class="hearts" id="hearts"></div>
</div>
<script src="./assets/ui.js"></script>
<script>
const vid=document.getElementById('vid');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');

setupStart(vid, hint);

function showDialog(text, avatarSrc='./assets/avatar_seongwoo.png', name='ì„±ìš°') {
    dialog.classList.add('show');
    avatar.src = avatarSrc;
    nameEl.textContent = name;
    line.textContent = text;
    btns.innerHTML = '';
    tap.style.display = 'block';
}

// ğŸš¨ íƒ­ì¹© ì „ìš© íƒ­ í•¨ìˆ˜
function awaitTapOnce(next){
  tap.style.display='block'; 
  const fn=(e)=>{ 
    tap.removeEventListener('click',fn); 
    tap.removeEventListener('touchend',fn); 
    tap.style.display = 'none'; 
    next(); 
  };
  tap.addEventListener('click',fn,{passive:true});
  tap.addEventListener('touchend',fn,{passive:true});
}

vid.addEventListener('ended', ()=>{
    tap.style.display = 'block'; 
    
    // 1. "ì™€ì¸...? ì´ëŸ° ë° ì™œ ìˆì§€?"
    awaitTapOnce(()=>{
        showDialog('ì™€ì¸...? ì´ëŸ° ë° ì™œ ìˆì§€?');
        
        // 2. "íƒœì´ê°€ ìˆ¨ê²¨ë‘” ê±´ê°€ ë´."
        awaitTapOnce(()=>{
            showDialog('íƒœì´ê°€ ìˆ¨ê²¨ë‘” ê±´ê°€ ë´.');
            
            // 3. "ì´ê±° ë§ˆì‹œë©´ ë”± ì¢‹ê² ë‹¤."
            awaitTapOnce(()=>{
                showDialog('ì´ê±° ë§ˆì‹œë©´ ë”± ì¢‹ê² ë‹¤.');
                
                // 4. ì„ íƒì§€ ë²„íŠ¼ ë“±ì¥ (ëŒ€ì‚¬ ì—†ìŒ)
                tap.style.display = 'none'; 
                
                const o=document.createElement('a'); o.className='btn'; o.textContent='ì™€ì¸ë°” ê°€ì„œ ë¶„ìœ„ê¸° ìˆê²Œ ë§ˆì‹œì! ğŸ¥‚';
                const x=document.createElement('a'); x.className='btn'; x.textContent='ì§‘ì—ì„œ ì˜¤ë¶“í•˜ê²Œ ë§ˆì‹œëŠ” ê²Œ ì¢‹ì•„! ğŸ’–';
                btns.append(o,x);
                
                // 5. ì„ íƒì§€ í´ë¦­ ì²˜ë¦¬
                o.onclick=x.onclick=(e)=>{ 
                    e.preventDefault(); 
                    btns.innerHTML='';
                    
                    // í™•ì • ëŒ€ì‚¬ ì¶œë ¥
                    showDialog('ì¢‹ì•„! ê·¸ë ‡ê²Œ í•˜ì! íƒœì´ë‘ í•¨ê»˜ë¼ë©´ ì–´ë””ë“  ì¢‹ì•„!');
                    
                    // 6. ë‹¤ìŒ ì„ ë¬¼ ë²„íŠ¼ í‘œì‹œ
                    awaitTapOnce(()=>{
                        tap.style.display = 'none';
                        const home=document.createElement('a');
                        home.href='./index.html';
                        home.className='btn';
                        home.textContent='ë‹¤ìŒ ì„ ë¬¼ ê³ ë¥´ëŸ¬ ê°€ê¸° ğŸ';
                        btns.appendChild(home);
                    });
                };
            });
        });
    });
}, {once:true});
</script>
</body>
</html>
