<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 2</title>
<style>
body{margin:0;background:#000;overflow:hidden;}
video{width:100vw;height:100vh;object-fit:contain;}
.dialog{display:none;}
.dialog.show{display:block!important;z-index:9999!important;}
.tapchip{
 position:fixed;left:50%;bottom:110px;transform:translateX(-50%);
 display:none;padding:12px 18px;border-radius:999px;
 background:rgba(20,28,38,.9);color:#fff;font-weight:700;font-size:1rem;
 border:1px solid rgba(255,255,255,.15);box-shadow:0 4px 18px rgba(0,0,0,.35);
 z-index:10000;
}
.tapchip:active{transform:translateX(-50%) scale(.96);}
</style>
</head>
<body>
<div class="stage">
  <video id="vid" src="./scene2_wine.mp4" preload="auto" playsinline webkit-playsinline muted></video>
  <div id="hint">ðŸŽ¬ START!</div>
  <div id="tap" class="tapchip">íƒ­!</div>
  <div id="dialog" class="dialog">
    <div class="row">
      <img id="avatar" src="./assets/avatar_seongwoo.png" alt="avatar" style="width:60px;height:60px;border-radius:50%;"/>
      <div class="bubble">
        <div id="name">ì„±ìš°</div>
        <div id="line"></div>
        <div id="btns"></div>
      </div>
    </div>
  </div>
</div>

<script>
const vid=document.getElementById('vid');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');

let tapAction=null,tapGuard=false;
function setTap(next){tapAction=next;tap.style.display='inline-flex';}
function clearTap(){tapAction=null;tap.style.display='none';}
tap.addEventListener('click',e=>{if(e.target!==tap)return;
  e.preventDefault();if(tapGuard)return;
  tapGuard=true;setTimeout(()=>tapGuard=false,200);
  const fn=tapAction;clearTap();if(typeof fn==='function')fn();});
tap.addEventListener('touchend',e=>{e.preventDefault();if(tapGuard)return;
  tapGuard=true;setTimeout(()=>tapGuard=false,200);
  const fn=tapAction;clearTap();if(typeof fn==='function')fn();});

function setupStart(){
 hint.style.display='block';
 const start=()=>{hint.style.display='none';vid.muted=true;vid.playsInline=true;
 vid.play().catch(()=>setTap(()=>vid.play()));};
 ['click','touchend','pointerdown'].forEach(ev=>
 document.addEventListener(ev,start,{once:true,passive:true}));
}
function showDialog(text,who='ì„±ìš°',avatarSrc='./assets/avatar_seongwoo.png'){
 dialog.classList.add('show');
 avatar.src=avatarSrc;
 nameEl.textContent=who;
 line.textContent=text;
 btns.innerHTML='';
}

setupStart();
vid.addEventListener('ended',()=>{
 showDialog('ì—¬ê¸°â€¦ ì™€ì¸ì´ë„¤?');
 setTap(()=>{
   showDialog('íƒœì´ê°€ ìˆ¨ê²¨ë‘” ê±´ê°€ ë´.');
   setTap(()=>{
     showDialog('ì´ê±° ë§ˆì‹œë©´ ë”± ì¢‹ê² ë‹¤.');
     setTap(()=>{
       clearTap();
       const o=document.createElement('a');o.className='btn';o.textContent='ì™€ì¸ë°” ê°€ì„œ ë¶„ìœ„ê¸° ìžˆê²Œ ë§ˆì‹œìž! ðŸ¥‚';
       const x=document.createElement('a');x.className='btn';x.textContent='ì§‘ì—ì„œ ì˜¤ë¶“í•˜ê²Œ ë§ˆì‹œëŠ” ê²Œ ì¢‹ì•„! ðŸ’–';
       btns.append(o,x);
       function choose(){
         showDialog('ì¢‹ì•„! ê·¸ë ‡ê²Œ í•˜ìž! íƒœì´ëž‘ í•¨ê»˜ë¼ë©´ ì–´ë””ë“  ì¢‹ì•„!');
         setTap(()=>{
           clearTap();
           const home=document.createElement('a');
           home.href='./index.html';
           home.className='btn';
           home.textContent='ë‹¤ìŒ ì„ ë¬¼ ê³ ë¥´ëŸ¬ ê°€ê¸° ðŸŽ';
           btns.appendChild(home);
         });
       }
       o.addEventListener('click',e=>{e.preventDefault();choose();},{once:true});
       x.addEventListener('click',e=>{e.preventDefault();choose();},{once:true});
     });
   });
 });
},{once:true});
</script>
</body>
</html>
