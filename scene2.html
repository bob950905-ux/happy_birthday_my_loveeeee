<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 2 (Final Stable)</title>
<link rel="stylesheet" href="./assets/ui.css"/>

<style>
.dialog { display: none; } 
.dialog.show { 
    display: block !important; 
    z-index: 9999;
}
.tapchip {
    z-index: 10000 !important;
}
</style>
</head>
<body>
<div class="stage">
  <video id="vid" src="./scene2_wine.mp4" preload="auto" playsinline webkit-playsinline muted></video>
  <div class="hint" id="hint">ğŸ¬ START!</div>
  <div class="tapchip" id="tap">íƒ­!</div>
  <div class="dialog" id="dialog">
    <div class="row" id="row">
      <img class="avatar" id="avatar" src="./assets/avatar_seongwoo.png" alt="avatar"/>
      <div class="bubble" id="bubble">
        <div class="name" id="name">ì„±ìš°</div>
        <div class="line" id="line"></div>
        <div class="center" id="btns"></div>
      </div>
    </div>
  </div>
  <div class="hearts" id="hearts"></div>
</div>
<script src="./assets/ui.js"></script>
<script>
const vid=document.getElementById('vid');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');

// ğŸš¨ ui.jsì— ì •ì˜ëœ í•¨ìˆ˜ ì‚¬ìš©ì„ ê°€ì •
setupStart(vid, hint);

// ëŒ€í™”ì°½ì„ í‘œì‹œí•˜ê³  ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
function showDialog(text, avatarSrc='./assets/avatar_seongwoo.png', name='ì„±ìš°') {
    dialog.classList.add('show');
    avatar.src = avatarSrc;
    nameEl.textContent = name;
    line.textContent = text;
    btns.innerHTML = '';
    tap.style.display = 'block'; // íƒ­ì¹©ì„ í‘œì‹œí•˜ì—¬ íƒ­ì„ ìœ ë„
}

// ğŸš¨ íƒ­ì¹© ì „ìš© íƒ­ í•¨ìˆ˜ ì¬ì •ì˜ (ui.jsë¥¼ ë®ì–´ì”ë‹ˆë‹¤.)
function awaitTapOnce(next){
  tap.style.display='block'; 
  const fn=(e)=>{ 
    tap.removeEventListener('click',fn); 
    tap.removeEventListener('touchend',fn); 
    tap.style.display = 'none'; // íƒ­ì¹© ìˆ¨ê¹€
    next(); 
  };
  tap.addEventListener('click',fn,{passive:true});
  tap.addEventListener('touchend',fn,{passive:true});
}

vid.addEventListener('ended', ()=>{
    tap.style.display = 'block'; 
    
    awaitTapOnce(()=>{
        // 1ë²ˆì§¸ ëŒ€ì‚¬: ì´ê±´â€¦ ì™€ì¸?
        showDialog('ì´ê±´â€¦ ì™€ì¸?');
        
        // 2ë²ˆì§¸ íƒ­ ëŒ€ê¸°
        awaitTapOnce(()=>{
            // 2ë²ˆì§¸ ëŒ€ì‚¬: íƒœì´ë‘ ë§ˆì…”ì•¼ì§€~ ğŸ·
            showDialog('íƒœì´ë‘ ë§ˆì…”ì•¼ì§€~ ğŸ·');
            
            // ë²„íŠ¼ ìƒì„± ë° íƒ­ì¹© ìˆ¨ê¹€
            tap.style.display = 'none';
            const home=document.createElement('a');
            home.href='./index.html';
            home.className='btn';
            home.textContent='ë‹¤ìŒ ì„ ë¬¼ ê³ ë¥´ëŸ¬ ê°€ê¸° ğŸ';
            btns.appendChild(home);
        });
    });
}, {once:true});
</script>
</body>
</html>
