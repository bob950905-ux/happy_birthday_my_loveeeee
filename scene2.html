<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 2 (Ultimate Stability Fix)</title>
<style>
/* íƒ­ì¹© CSS (ì•ˆì •í™”ëœ ìœ„ì¹˜ì™€ í¬ê¸° í¬í•¨) */
body{margin:0;background:#000;overflow:hidden;}
video{width:100vw;height:100vh;object-fit:contain;}
.dialog{display:none;}
.dialog.show{display:block!important;z-index:9999!important;}

.tapchip{
Â position:fixed!important;
Â left:50%;
Â bottom:110px;
Â transform:translateX(-50%);
Â display:none;
Â padding:15px 30px; /* í„°ì¹˜ ì˜ì—­ ì¶©ë¶„íˆ í™•ë³´ */
Â border-radius:999px;
Â background:rgba(20,28,38,.9);
Â color:#fff;
Â font-weight:700;
Â font-size:1.2rem; /* í¬ê¸° í™•ëŒ€ */
Â border:1px solid rgba(255,255,255,.15);
Â box-shadow:0 4px 18px rgba(0,0,0,.35);
Â z-index:10002!important; /* íƒ­ì¹©ì´ ëª¨ë“  ìš”ì†Œ ìœ„ì— ì˜¤ë„ë¡ ë³´ì¥ */
Â width: auto !important;
Â height: auto !important;
}
.tapchip:active{transform:translateX(-50%) scale(.96);}

/* START íŒíŠ¸ë„ íƒ­ì¹©ë³´ë‹¤ ì•„ë˜ì— ì˜¤ë„ë¡ ì„¤ì • */
#hint {
    z-index: 10001 !important;
}
</style>
</head>
<body>
<div class="stage">
Â  <video id="vid" src="./scene2_wine.mp4" preload="auto" playsinline webkit-playsinline muted></video>
Â  <div id="hint">ğŸ¬ START!</div>
Â  <div id="tap" class="tapchip">íƒ­!</div>
Â  <div id="dialog" class="dialog">
Â  Â  <div class="row">
Â  Â  Â  <img id="avatar" src="./assets/avatar_seongwoo.png" alt="avatar" style="width:60px;height:60px;border-radius:50%;"/>
Â  Â  Â  <div class="bubble">
Â  Â  Â  Â  <div id="name">ì„±ìš°</div>
Â  Â  Â  Â  <div id="line"></div>
Â  Â  Â  Â  <div id="btns"></div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>

<script>
const vid=document.getElementById('vid');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');

let tapAction=null,tapGuard=false;

// --- íƒ­ ë¡œì§ (ì›ë³¸ ìœ ì§€ ë° ì•ˆì •í™”) ---
function setTap(next){tapAction=next;tap.style.display='inline-flex';}
function clearTap(){tapAction=null;tap.style.display='none';}
tap.addEventListener('click',e=>{
  if(tapGuard)return;
  tapGuard=true;setTimeout(()=>tapGuard=false,200);
  const fn=tapAction;clearTap();if(typeof fn==='function')fn();
});
tap.addEventListener('touchend',e=>{
  e.preventDefault();if(tapGuard)return;
  tapGuard=true;setTimeout(()=>tapGuard=false,200);
  const fn=tapAction;clearTap();if(typeof fn==='function')fn();
});

function setupStart(){
Â hint.style.display='block';
Â const start=()=>{
    // ğŸš¨ START ë²„íŠ¼ ê°•ì œ ìˆ¨ê¹€
    hint.style.display='none';
    vid.muted=true;vid.playsInline=true;
Â    vid.play().catch(()=>{
        // ìë™ ì¬ìƒ ì‹¤íŒ¨ ì‹œ ë¹„ë””ì˜¤ ì¬ìƒì„ ìœ„í•´ setTap í˜¸ì¶œ
        setTap(()=>vid.play());
    });
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
Â    ['click','touchend','pointerdown'].forEach(ev => document.removeEventListener(ev, start));
};
Â ['click','touchend','pointerdown'].forEach(ev=>
Â document.addEventListener(ev,start,{once:true,passive:true}));
}

function showDialog(text,who='ì„±ìš°',avatarSrc='./assets/avatar_seongwoo.png'){
Â dialog.classList.add('show');
Â avatar.src=avatarSrc;
Â nameEl.textContent=who;
Â line.textContent=text;
Â btns.innerHTML='';
}

// --- ëŒ€í™” ë¡œì§ ì‹œì‘ ---
setupStart();
vid.addEventListener('ended',()=>{
Â  // 1. "ì™€ì¸...? ì´ëŸ° ë° ì™œ ìˆì§€?"
Â  showDialog('ì™€ì¸...? ì´ëŸ° ë° ì™œ ìˆì§€?');
Â  setTap(()=>{
Â  Â  // 2. "íƒœì´ê°€ ìˆ¨ê²¨ë‘” ê±´ê°€ ë´."
Â  Â  showDialog('íƒœì´ê°€ ìˆ¨ê²¨ë‘” ê±´ê°€ ë´.');
Â  Â  setTap(()=>{
Â  Â  Â  // 3. "ì´ê±° ë§ˆì‹œë©´ ë”± ì¢‹ê² ë‹¤."
Â  Â  Â  showDialog('ì´ê±° ë§ˆì‹œë©´ ë”± ì¢‹ê² ë‹¤.');
Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  // 4. ì„ íƒì§€ ë²„íŠ¼ ë“±ì¥
Â  Â  Â  Â  clearTap(); // íƒ­ì¹© ìˆ¨ê¹€
Â  Â  Â  Â  
Â  Â  Â  Â  const o=document.createElement('a');o.className='btn';o.textContent='ì™€ì¸ë°” ê°€ì„œ ë¶„ìœ„ê¸° ìˆê²Œ ë§ˆì‹œì! ğŸ¥‚';
Â  Â  Â  Â  const x=document.createElement('a');x.className='btn';x.textContent='ì§‘ì—ì„œ ì˜¤ë¶“í•˜ê²Œ ë§ˆì‹œëŠ” ê²Œ ì¢‹ì•„! ğŸ’–';
Â  Â  Â  Â  btns.append(o,x);
Â  Â  Â  Â  
Â  Â  Â  Â  // 5. ì„ íƒì§€ í´ë¦­ ì²˜ë¦¬ ë° 6. ë‹¤ìŒ ì„ ë¬¼ ë²„íŠ¼ í‘œì‹œ
Â  Â  Â  Â  function choose(e){
            e.preventDefault(); 
            btns.innerHTML = ''; // ë²„íŠ¼ ì œê±°
            
Â  Â  Â  Â  Â  Â  // 5. í™•ì • ëŒ€ì‚¬
Â  Â  Â  Â  Â  Â  showDialog('ì¢‹ì•„! ê·¸ë ‡ê²Œ í•˜ì! íƒœì´ë‘ í•¨ê»˜ë¼ë©´ ì–´ë””ë“  ì¢‹ì•„!');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 6. ë‹¤ìŒ íƒ­ì„ ê¸°ë‹¤ë ¤ ë©”ì¸ ë²„íŠ¼ í‘œì‹œ
Â  Â  Â  Â  Â  Â  setTap(()=>{
Â  Â  Â  Â  Â  Â  Â  Â  clearTap();
Â  Â  Â  Â  Â  Â  Â  Â  const home=document.createElement('a');
Â  Â  Â  Â  Â  Â  Â  Â  home.href='./index.html';
Â  Â  Â  Â  Â  Â  Â  Â  home.className='btn';
Â  Â  Â  Â  Â  Â  Â  Â  home.textContent='ë‹¤ìŒ ì„ ë¬¼ ê³ ë¥´ëŸ¬ ê°€ê¸° ğŸ';
Â  Â  Â  Â  Â  Â  Â  Â  btns.appendChild(home);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
Â  Â  Â  Â  o.addEventListener('click',choose,{once:true});
Â  Â  Â  Â  x.addEventListener('click',choose,{once:true});
Â  Â  Â });
Â  Â });
Â });
},{once:true});
</script>
</body>
</html>
