<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Scene 2 (Final Stable - Integrated)</title>
<link rel="stylesheet" href="./assets/ui.css"/>

<style>
.dialog { display: none; } 
.dialog.show { 
    display: block !important; 
    z-index: 9999;
}
.tapchip {
    position: absolute; 
    right: 30px; 
    left: auto;
    bottom: 25vh;
    z-index: 10000 !important;
    padding: 15px 30px; 
    font-size: 1.2em; 
    border-radius: 20px; 
    border: 2px solid white; 
    background-color: rgba(0, 0, 0, 0.7); 
    color: white; 
    cursor: pointer;
}
</style>
</head>
<body>
<div class="stage">
  <video id="vid" src="./scene2_wine.mp4" preload="auto" playsinline webkit-playsinline muted></video>
  <div class="hint" id="hint">üé¨ START!</div>
  <div class="tapchip" id="tap">ÌÉ≠!</div>
  <div class="dialog" id="dialog">
    <div class="row" id="row">
      <img class="avatar" id="avatar" src="./assets/avatar_seongwoo.png" alt="avatar"/>
      <div class="bubble" id="bubble">
        <div class="name" id="name">ÏÑ±Ïö∞</div>
        <div class="line" id="line"></div>
        <div class="center" id="btns"></div>
      </div>
    </div>
  </div>
  <div class="hearts" id="hearts"></div>
</div>
<script>
const vid=document.getElementById('vid');
const hint=document.getElementById('hint');
const tap=document.getElementById('tap');
const dialog=document.getElementById('dialog');
const avatar=document.getElementById('avatar');
const nameEl=document.getElementById('name');
const line=document.getElementById('line');
const btns=document.getElementById('btns');
const hearts=document.getElementById('hearts'); // hearts Î≥ÄÏàò Ï∂îÍ∞Ä

// --- ÌÜµÌï© Ìï®Ïàò: awaitTapOnce ---
function awaitTapOnce(next){
  tap.style.display='block'; 
  const fn=(e)=>{ 
    tap.removeEventListener('click',fn); 
    tap.removeEventListener('touchend',fn); 
    tap.style.display = 'none'; 
    next(); 
  };
  tap.addEventListener('click',fn,{passive:true});
  tap.addEventListener('touchend',fn,{passive:true});
}

// --- ÌÜµÌï© Ìï®Ïàò: setupStart ---
function setupStart(vid,hint){
  hint.style.display='block';
  const start=()=>{
    hint.style.display='none'; 
    vid.muted=true; vid.playsInline=true;
    vid.play().catch(()=>{ tap.style.display='block'; });
  };
  ['click','touchend','pointerdown'].forEach(ev=>document.addEventListener(ev,start,{once:true,passive:true}));
}

// --- ÌÜµÌï© Ìï®Ïàò: showDialog ---
function showDialog(text, avatarSrc='./assets/avatar_seongwoo.png', name='ÏÑ±Ïö∞') {
    dialog.classList.add('show');
    avatar.src = avatarSrc;
    nameEl.textContent = name;
    line.textContent = text;
    btns.innerHTML = '';
    tap.style.display = 'block';
}

// --- Ï¥àÍ∏∞ Ïã§Ìñâ ---
setupStart(vid, hint);

vid.addEventListener('ended', ()=>{
    tap.style.display = 'block'; 
    
    // 1. "ÏôÄÏù∏...? Ïù¥Îü∞ Îç∞ Ïôú ÏûàÏßÄ?"
    awaitTapOnce(()=>{
        showDialog('ÏôÄÏù∏...? Ïù¥Îü∞ Îç∞ Ïôú ÏûàÏßÄ?');
        
        // 2. "ÌÉúÏù¥Í∞Ä Ïà®Í≤®Îëî Í±¥Í∞Ä Î¥ê."
        awaitTapOnce(()=>{
            showDialog('ÌÉúÏù¥Í∞Ä Ïà®Í≤®Îëî Í±¥Í∞Ä Î¥ê.');
            
            // 3. "Ïù¥Í±∞ ÎßàÏãúÎ©¥ Îî± Ï¢ãÍ≤†Îã§."
            awaitTapOnce(()=>{
                showDialog('Ïù¥Í±∞ ÎßàÏãúÎ©¥ Îî± Ï¢ãÍ≤†Îã§.');
                
                // 4. ÏÑ†ÌÉùÏßÄ Î≤ÑÌäº Îì±Ïû• (ÎåÄÏÇ¨ ÏóÜÏùå)
                tap.style.display = 'none'; 
                
                const o=document.createElement('a'); o.className='btn'; o.textContent='ÏôÄÏù∏Î∞î Í∞ÄÏÑú Î∂ÑÏúÑÍ∏∞ ÏûàÍ≤å ÎßàÏãúÏûê! ü•Ç';
                const x=document.createElement('a'); o.className='btn'; x.textContent='ÏßëÏóêÏÑú Ïò§Î∂ìÌïòÍ≤å ÎßàÏãúÎäî Í≤å Ï¢ãÏïÑ! üíñ';
                btns.append(o,x);
                
                // 5. ÏÑ†ÌÉùÏßÄ ÌÅ¥Î¶≠ Ï≤òÎ¶¨
                o.onclick=x.onclick=(e)=>{ 
                    e.preventDefault(); 
                    btns.innerHTML='';
                    
                    // ÌôïÏ†ï ÎåÄÏÇ¨ Ï∂úÎ†•
                    showDialog('Ï¢ãÏïÑ! Í∑∏Î†áÍ≤å ÌïòÏûê! ÌÉúÏù¥Îûë Ìï®ÍªòÎùºÎ©¥ Ïñ¥ÎîîÎì† Ï¢ãÏïÑ!');
                    
                    // 6. Îã§Ïùå ÏÑ†Î¨º Î≤ÑÌäº ÌëúÏãú
                    awaitTapOnce(()=>{
                        tap.style.display = 'none';
                        const home=document.createElement('a');
                        home.href='./index.html';
                        home.className='btn';
                        home.textContent='Îã§Ïùå ÏÑ†Î¨º Í≥†Î•¥Îü¨ Í∞ÄÍ∏∞ üéÅ';
                        btns.appendChild(home);
                    });
                };
            });
        });
    });
}, {once:true});
</script>
</body>
</html>
